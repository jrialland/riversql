var Base64=(function(){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function b(e){e=e.replace(/\r\n/g,"\n");var d="";for(var g=0;g<e.length;g++){var f=e.charCodeAt(g);if(f<128){d+=String.fromCharCode(f)}else{if((f>127)&&(f<2048)){d+=String.fromCharCode((f>>6)|192);d+=String.fromCharCode((f&63)|128)}else{d+=String.fromCharCode((f>>12)|224);d+=String.fromCharCode(((f>>6)&63)|128);d+=String.fromCharCode((f&63)|128)}}}return d}return{encode:(typeof btoa=="function")?function(c){return btoa(c)}:function(e){var c="";var m,k,h,l,j,g,f;var d=0;e=b(e);while(d<e.length){m=e.charCodeAt(d++);k=e.charCodeAt(d++);h=e.charCodeAt(d++);l=m>>2;j=((m&3)<<4)|(k>>4);g=((k&15)<<2)|(h>>6);f=h&63;if(isNaN(k)){g=f=64}else{if(isNaN(h)){f=64}}c=c+a.charAt(l)+a.charAt(j)+a.charAt(g)+a.charAt(f)}return c}}})();Ext.override(Ext.grid.GridPanel,{getExcelXml:function(b){var c=this.createWorksheet(b);var a=this.getColumnModel().getTotalWidth(b);return'<?xml version="1.0" encoding="utf-8"?><ss:Workbook xmlns:ss="urn:schemas-microsoft-com:office:spreadsheet" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns:o="urn:schemas-microsoft-com:office:office"><o:DocumentProperties><o:Title>'+this.title+"</o:Title></o:DocumentProperties><ss:ExcelWorkbook><ss:WindowHeight>"+c.height+"</ss:WindowHeight><ss:WindowWidth>"+c.width+'</ss:WindowWidth><ss:ProtectStructure>False</ss:ProtectStructure><ss:ProtectWindows>False</ss:ProtectWindows></ss:ExcelWorkbook><ss:Styles><ss:Style ss:ID="Default"><ss:Alignment ss:Vertical="Top" ss:WrapText="1" /><ss:Font ss:FontName="arial" ss:Size="10" /><ss:Borders><ss:Border ss:Color="#e4e4e4" ss:Weight="1" ss:LineStyle="Continuous" ss:Position="Top" /><ss:Border ss:Color="#e4e4e4" ss:Weight="1" ss:LineStyle="Continuous" ss:Position="Bottom" /><ss:Border ss:Color="#e4e4e4" ss:Weight="1" ss:LineStyle="Continuous" ss:Position="Left" /><ss:Border ss:Color="#e4e4e4" ss:Weight="1" ss:LineStyle="Continuous" ss:Position="Right" /></ss:Borders><ss:Interior /><ss:NumberFormat /><ss:Protection /></ss:Style><ss:Style ss:ID="title"><ss:Borders /><ss:Font /><ss:Alignment ss:WrapText="1" ss:Vertical="Center" ss:Horizontal="Center" /><ss:NumberFormat ss:Format="@" /></ss:Style><ss:Style ss:ID="headercell"><ss:Font ss:Bold="1" ss:Size="10" /><ss:Alignment ss:WrapText="1" ss:Horizontal="Center" /><ss:Interior ss:Pattern="Solid" ss:Color="#A3C9F1" /></ss:Style><ss:Style ss:ID="even"><ss:Interior ss:Pattern="Solid" ss:Color="#CCFFFF" /></ss:Style><ss:Style ss:Parent="even" ss:ID="evendate"><ss:NumberFormat ss:Format="[ENG][$-409]dd-mmm-yyyy;@" /></ss:Style><ss:Style ss:Parent="even" ss:ID="evenint"><ss:NumberFormat ss:Format="0" /></ss:Style><ss:Style ss:Parent="even" ss:ID="evenfloat"><ss:NumberFormat ss:Format="0.00" /></ss:Style><ss:Style ss:ID="odd"><ss:Interior ss:Pattern="Solid" ss:Color="#CCCCFF" /></ss:Style><ss:Style ss:Parent="odd" ss:ID="odddate"><ss:NumberFormat ss:Format="[ENG][$-409]dd-mmm-yyyy;@" /></ss:Style><ss:Style ss:Parent="odd" ss:ID="oddint"><ss:NumberFormat ss:Format="0" /></ss:Style><ss:Style ss:Parent="odd" ss:ID="oddfloat"><ss:NumberFormat ss:Format="0.00" /></ss:Style></ss:Styles>'+c.xml+"</ss:Workbook>"},createWorksheet:function(b){var q=[];var n=[];var e=this.getColumnModel();var d=0;var a="";var u="";for(var y=0;y<e.getColumnCount();y++){if(b||!e.isHidden(y)){var g=e.getColumnWidth(y);d+=g;a+='<ss:Column ss:AutoFitWidth="1" ss:Width="'+g+'" />';u+='<ss:Cell ss:StyleID="headercell"><ss:Data ss:Type="String">'+e.getColumnHeader(y)+'</ss:Data><ss:NamedCell ss:Name="Print_Titles" /></ss:Cell>';q.push("String");n.push("")}}var z=q.length;var f={height:9000,width:Math.floor(d*30)+50};this.title="SQL Query Export";var m='<ss:Worksheet ss:Name="'+this.title+'"><ss:Names><ss:NamedRange ss:Name="Print_Titles" ss:RefersTo="=\''+this.title+'\'!R1:R2" /></ss:Names><ss:Table x:FullRows="1" x:FullColumns="1" ss:ExpandedColumnCount="'+z+'" ss:ExpandedRowCount="'+(this.store.getCount()+2)+'">'+a+'<ss:Row ss:Height="38"><ss:Cell ss:StyleID="title" ss:MergeAcross="'+(z-1)+'"><ss:Data xmlns:html="http://www.w3.org/TR/REC-html40" ss:Type="String"><html:B><html:U><html:Font html:Size="15">'+this.title+'</html:Font></html:U></html:B>Generated by riversql</ss:Data><ss:NamedCell ss:Name="Print_Titles" /></ss:Cell></ss:Row><ss:Row ss:AutoFitHeight="1">'+u+"</ss:Row>";for(var y=0,c=this.store.data.items,p=c.length;y<p;y++){m+="<ss:Row>";var o=(y&1)?"odd":"even";r=c[y].data;var s=0;for(var x=0;x<e.getColumnCount();x++){if(b||!e.isHidden(x)){var h=r[e.getDataIndex(x)];m+='<ss:Cell ss:StyleID="'+o+n[s]+'"><ss:Data ss:Type="'+q[s]+'">';if(q[s]=="DateTime"){m+=h.format("Y-m-d")}else{m+=h}m+="</ss:Data></ss:Cell>";s++}}m+="</ss:Row>"}f.xml=m+'</ss:Table><x:WorksheetOptions><x:PageSetup><x:Layout x:CenterHorizontal="1" x:Orientation="Landscape" /><x:Footer x:Data="Page &amp;P of &amp;N" x:Margin="0.5" /><x:PageMargins x:Top="0.5" x:Right="0.5" x:Left="0.5" x:Bottom="0.8" /></x:PageSetup><x:FitToPage /><x:Print><x:PrintErrors>Blank</x:PrintErrors><x:FitWidth>1</x:FitWidth><x:FitHeight>32767</x:FitHeight><x:ValidPrinterInfo /><x:VerticalResolution>600</x:VerticalResolution></x:Print><x:Selected /><x:DoNotDisplayGridlines /><x:ProtectObjects>False</x:ProtectObjects><x:ProtectScenarios>False</x:ProtectScenarios></x:WorksheetOptions></ss:Worksheet>';return f}});var xsmargin=-5;var xemargin=10;var ysmargin=-5;var yemargin=17;draw2d.WindowFigure.ZOrderIndex=5000;TableConnectionDecorator=function(){this.setBackgroundColor(new draw2d.Color(255,255,255))};TableConnectionDecorator.prototype=new draw2d.ConnectionDecorator;TableConnectionDecorator.prototype.type="TableConnectionDecorator";TableConnectionDecorator.prototype.paint=function(a){if(this.backgroundColor!=null){a.setColor(this.backgroundColor);a.fillPolygon([3,20,20,3],[0,8,-8,0])}a.setColor(this.color);a.setStroke(1);a.drawPolygon([3,20,20,3],[0,8,-8,0])};TableConnection=function(c){draw2d.Connection.call(this);this.setTargetDecorator(new TableConnectionDecorator());this.setSourceAnchor(new draw2d.ChopboxConnectionAnchor());this.setTargetAnchor(new draw2d.ChopboxConnectionAnchor());this.setRouter(new draw2d.ManhattanConnectionRouter());var b=new draw2d.Label(c);b.setBackgroundColor(new draw2d.Color(255,255,255));b.setBorder(new draw2d.LineBorder(1));var a=new draw2d.ManhattanMidpointLocator(this);this.addFigure(b,a)};TableConnection.prototype=new draw2d.Connection();TableConnection.prototype.addFigure=function(c,b){var e=new Object();e.figure=c;e.locator=b;this.children.add(e);if(this.graphics!=null){this.paint()}var d=this;var a=function(){var f=arguments[0]||window.event;f.returnValue=false;d.getWorkflow().setCurrentSelection(d);d.getWorkflow().showLineResizeHandles(d)};if(c.getHTMLElement().addEventListener){c.getHTMLElement().addEventListener("mousedown",a,false)}else{if(c.getHTMLElement().attachEvent){c.getHTMLElement().attachEvent("onmousedown",a)}}};TablePort=function(){var a=new draw2d.Circle();draw2d.Port.call(this,a);this.setDimension(10,10);this.setBackgroundColor(new draw2d.Color(190,190,255))};TablePort.prototype=new draw2d.Port;TablePort.prototype.type="TablePort";TablePort.prototype.onDrop=function(a){if(this.parentNode.id==a.parentNode.id){}else{obj=this;obj.port_=a;function b(d,f){var e=new draw2d.CommandConnect(obj.parentNode.workflow,obj,obj.port_);var c=new TableConnection(f);e.setConnection(c);obj.parentNode.workflow.getCommandStack().execute(e)}Ext.MessageBox.prompt("Name","Please enter the name:",b)}};TableConnection.prototype.isResizeable=function(){return false};TableConnection.prototype.paint=function(){for(var a=0;a<this.children.getSize();a++){var b=this.children.get(a);if(b.isAppended==true){this.html.removeChild(b.figure.getHTMLElement())}b.isAppended=false}if(this.graphics==null){this.graphics=new jsGraphics(this.id)}else{this.graphics.clear()}this.graphics.setStroke(this.stroke);this.graphics.setColor(this.lineColor.getHTMLStyle());this.startStroke();this.router.route(this);if(this.targetDecorator!=null){this.targetDecorator.paint(new draw2d.Graphics(this.graphics,this.getEndAngle(),this.getEndPoint()))}if(this.sourceDecorator!=null){this.sourceDecorator.paint(new draw2d.Graphics(this.graphics,this.getStartAngle(),this.getStartPoint()))}this.finishStroke();for(var a=0;a<this.children.getSize();a++){var b=this.children.get(a);this.html.appendChild(b.figure.getHTMLElement());b.isAppended=true;b.locator.relocate(b.figure)}};TableWorkflow=function(a){draw2d.Workflow.call(this,a);this.addremoveListeners=new draw2d.ArrayList()};TableWorkflow.prototype=new draw2d.Workflow;TableWorkflow.prototype.clear=function(){this.scrollTo(0,0,true);this.gridWidthX=10;this.gridWidthY=10;this.snapToGridHelper=null;this.verticalSnapToHelperLine=null;this.horizontalSnapToHelperLine=null;var b=this.getDocument();var a=b.getLines().clone();for(var c=0;c<a.getSize();c++){new draw2d.CommandDelete(a.get(c)).execute()}var d=this.getFigures().clone();for(var c=0;c<d.getSize();c++){new TableCommandDelete(d.get(c)).execute()}this.commonPorts.removeAllElements();this.dropTargets.removeAllElements();this.compartments.removeAllElements();this.selectionListeners.removeAllElements();this.dialogs.removeAllElements();this.commandStack=new draw2d.CommandStack();this.currentSelection=null;this.currentMenu=null;draw2d.Drag.clearCurrent();this.addremoveListeners.removeAllElements()};TableWorkflow.prototype.addAddRemoveListener=function(a){if(a!=null){this.addremoveListeners.add(a)}};TableWorkflow.prototype.removeAddRemoveListener=function(a){this.addremoveListeners.remove(a)};TableWorkflow.prototype.addFigure=function(a,e,d){draw2d.Workflow.prototype.addFigure.call(this,a,e,d);for(var c=0;c<this.addremoveListeners.getSize();c++){var b=this.addremoveListeners.get(c);if(b.onAdded){b.onAdded(a)}}};TableWorkflow.prototype.removeFigure=function(a){draw2d.Workflow.prototype.removeFigure.call(this,a);for(var c=0;c<this.addremoveListeners.getSize();c++){var b=this.addremoveListeners.get(c);if(b.onRemoved){b.onRemoved(a)}}};TableWorkflow.prototype.type="TableWorkflow";TableWorkflow.prototype.showResizeHandles=function(c){this.hideLineResizeHandles();this.hideResizeHandles();if(this.getEnableSmoothFigureHandling()==true&&this.getCurrentSelection()!=c){this.resizeHandle1.setAlpha(0.01);this.resizeHandle2.setAlpha(0.01);this.resizeHandle3.setAlpha(0.01);this.resizeHandle4.setAlpha(0.01);this.resizeHandle5.setAlpha(0.01);this.resizeHandle6.setAlpha(0.01);this.resizeHandle7.setAlpha(0.01);this.resizeHandle8.setAlpha(0.01)}var e=this.resizeHandle1.getWidth();var a=this.resizeHandle1.getHeight();var b=c.getHeight()+yemargin;var d=c.getWidth()+xemargin;var h=c.getX()+xsmargin;var f=c.getY()+ysmargin;draw2d.Canvas.prototype.addFigure.call(this,this.resizeHandle1,h-e,f-a);draw2d.Canvas.prototype.addFigure.call(this,this.resizeHandle3,h+d,f-a);draw2d.Canvas.prototype.addFigure.call(this,this.resizeHandle5,h+d,f+b);draw2d.Canvas.prototype.addFigure.call(this,this.resizeHandle7,h-e,f+b);this.moveFront(this.resizeHandle1);this.moveFront(this.resizeHandle3);this.moveFront(this.resizeHandle5);this.moveFront(this.resizeHandle7);this.resizeHandle1.setCanDrag(c.isResizeable());this.resizeHandle3.setCanDrag(c.isResizeable());this.resizeHandle5.setCanDrag(c.isResizeable());this.resizeHandle7.setCanDrag(c.isResizeable());if(c.isResizeable()){var g=new draw2d.Color(0,255,0);this.resizeHandle1.setBackgroundColor(g);this.resizeHandle3.setBackgroundColor(g);this.resizeHandle5.setBackgroundColor(g);this.resizeHandle7.setBackgroundColor(g)}else{this.resizeHandle1.setBackgroundColor(null);this.resizeHandle3.setBackgroundColor(null);this.resizeHandle5.setBackgroundColor(null);this.resizeHandle7.setBackgroundColor(null)}if(c.isStrechable()&&c.isResizeable()){this.resizeHandle2.setCanDrag(c.isResizeable());this.resizeHandle4.setCanDrag(c.isResizeable());this.resizeHandle6.setCanDrag(c.isResizeable());this.resizeHandle8.setCanDrag(c.isResizeable());draw2d.Canvas.prototype.addFigure.call(this,this.resizeHandle2,h+(d/2)-this.resizeHandleHalfWidth,f-a);draw2d.Canvas.prototype.addFigure.call(this,this.resizeHandle4,h+d,f+(b/2)-(a/2));draw2d.Canvas.prototype.addFigure.call(this,this.resizeHandle6,h+(d/2)-this.resizeHandleHalfWidth,f+b);draw2d.Canvas.prototype.addFigure.call(this,this.resizeHandle8,h-e,f+(b/2)-(a/2));this.moveFront(this.resizeHandle2);this.moveFront(this.resizeHandle4);this.moveFront(this.resizeHandle6);this.moveFront(this.resizeHandle8)}};TableWorkflow.prototype.moveResizeHandles=function(d){var b=this.resizeHandle1.getWidth();var c=this.resizeHandle1.getHeight();var a=d.getHeight()+yemargin;var g=d.getWidth()+xemargin;var f=d.getX()+xsmargin;var e=d.getY()+ysmargin;this.resizeHandle1.setPosition(f-b,e-c);this.resizeHandle3.setPosition(f+g,e-c);this.resizeHandle5.setPosition(f+g,e+a);this.resizeHandle7.setPosition(f-b,e+a);if(d.isStrechable()){this.resizeHandle2.setPosition(f+(g/2)-this.resizeHandleHalfWidth,e-c);this.resizeHandle4.setPosition(f+g,e+(a/2)-(c/2));this.resizeHandle6.setPosition(f+(g/2)-this.resizeHandleHalfWidth,e+a);this.resizeHandle8.setPosition(f-b,e+(a/2)-(c/2))}};TableWorkflow.prototype.loadTables=function(f){for(var e=0;e<f.length;e++){var b=f[e].x;var h=f[e].y;var g=f[e].width;var a=f[e].height;var d=f[e].name;var c=new TableFigure(d);this.addFigure(c,b,h);c.addColumns(f[e].columns);c.setDimension(g,a);if(f[e].open==false){c.collapse()}}};TableWorkflow.prototype.loadConnections=function(k){for(var c=0;c<k.length;c++){var a=k[c].source;var f=k[c].target;var h=null;var e=null;for(var d=0;d<this.figures.getSize();d++){var g=this.figures.get(d);if(g.title==a){h=g;break}}for(var d=0;d<this.figures.getSize();d++){var g=this.figures.get(d);if(g.title==f){e=g;break}}if(h==null||e==null){continue}var b=new TableConnection("A");b.setSource(h.portTop);b.setTarget(e.portBottom);this.addFigure(b)}};TableFigure=function(a){draw2d.WindowFigure.call(this,a);this.children=new Object();this.length=0;this.setZOrder(TableFigure.ZOrderIndex);this.ports=new draw2d.ArrayList();this.setDeleteable(true);this.open=true;this.resizeable=true};TableFigure.ZOrderBaseIndex=100;TableFigure.setZOrderBaseIndex=function(a){draw2d.WindowFigure.ZOrderBaseIndex=a};TableFigure.prototype=new draw2d.WindowFigure;TableFigure.prototype.type="TableFigure";TableFigure.prototype.isSelectable=function(){return true};TableFigure.prototype.isResizeable=function(){return this.resizeable};TableFigure.prototype.dispose=function(){draw2d.Figure.prototype.dispose.call(this);for(var a=0;a<this.ports.getSize();a++){this.ports.get(a).dispose()}this.ports=null;this.children=null};TableFigure.prototype.paint=function(){draw2d.WindowFigure.prototype.paint.call(this);for(var a=0;a<this.ports.getSize();a++){this.ports.get(a).paint()}};TableFigure.prototype.getPorts=function(){return this.ports};TableFigure.prototype.getPort=function(c){if(this.ports==null){return null}for(var b=0;b<this.ports.getSize();b++){var a=this.ports.get(b);if(a.getName()==c){return a}}};TableFigure.prototype.addPort=function(b,a,c){this.ports.add(b);b.setOrigin(a,c);b.setPosition(a,c);b.setParent(this);b.setDeleteable(false);this.html.appendChild(b.getHTMLElement());if(this.workflow!=null){this.workflow.registerPort(b)}};TableFigure.prototype.removePort=function(b){if(this.ports!=null){this.ports.removeElementAt(this.ports.indexOf(b))}try{this.html.removeChild(b.getHTMLElement())}catch(a){}if(this.workflow!=null){this.workflow.unregisterPort(b)}};TableFigure.prototype.setWorkflow=function(c){var b=this.workflow;draw2d.WindowFigure.prototype.setWorkflow.call(this,c);if(b!=null){for(var a=0;a<this.ports.getSize();a++){b.unregisterPort(this.ports.get(a))}}if(c!=null&&this.portTop==null){this.portTop=new TablePort();this.portTop.setWorkflow(c);this.addPort(this.portTop,0,0);this.portRight=new TablePort();this.portRight.setWorkflow(c);this.addPort(this.portRight,0,0);this.portBottom=new TablePort();this.portBottom.setWorkflow(c);this.addPort(this.portBottom,0,0);this.portLeft=new TablePort();this.portLeft.setWorkflow(c);this.addPort(this.portLeft,0,0);this.recalculateSize()}};TableFigure.prototype.recalculateSize=function(a){this.setDimension(this.getWidth(),this.getHeight())};TableFigure.prototype.refreshConnections=function(){if(this.workflow!=null){this.workflow.refreshConnections(this)}};TableFigure.prototype.createHTMLElement=function(){var c=draw2d.Figure.prototype.createHTMLElement.call(this);c.className="x-window";c.style.display="block";this.titlebar=document.createElement("div");this.titlebar.className="x-window-tl";tr=document.createElement("div");tr.style.overflow="hidden";tr.className="x-window-tr";tc=document.createElement("div");tc.style.overflow="hidden";tc.className="x-window-tc";tr.appendChild(tc);tcheader=document.createElement("div");tcheader.className="x-window-header x-unselectable ";tcheader.style.overflow="hidden";this.tool=document.createElement("div");this.tool.className="x-tool x-tool-toggle x-tool-minimize";tcheader.appendChild(this.tool);tc.appendChild(tcheader);sp=document.createElement("span");sp.className="x-window-header-text";sp.style.cursor="move";sp.style.overflow="hidden";sp.style.textOverflow="ellipsis";sp.style.display="block";tcheader.appendChild(sp);this.titlebar.appendChild(tr);this.textNode=document.createTextNode(this.title);sp.appendChild(this.textNode);c.appendChild(this.titlebar);this.titlebar.style.height="20px";this.scrollarea=document.createElement("div");this.scrollarea.style.position="absolute";this.scrollarea.style.height="15px";this.scrollarea.style.margin="0px";this.scrollarea.style.padding="0px";this.scrollarea.style.font="normal 10px verdana";this.scrollarea.style.whiteSpace="nowrap";this.scrollarea.style.textAlign="center";this.scrollarea.style.overflowX="hidden";this.scrollarea.style.overflowY="hidden";this.scrollarea.style.overflow="hidden";this.scrollarea.style.cursor="default";this.scrollarea.style.backgroundColor="white";this.wraparea=document.createElement("div");this.wraparea.className="x-window-bwrap";var h=document.createElement("div");h.className="x-window-ml";var b=document.createElement("div");b.className="x-window-mr";var e=document.createElement("div");e.className="x-window-mc";this.xbody=document.createElement("div");this.xbody.className="x-window-body";this.wraparea.appendChild(h);h.appendChild(b);b.appendChild(e);e.appendChild(this.xbody);this.xbody.appendChild(this.scrollarea);c.appendChild(this.wraparea);var g=document.createElement("div");g.className="x-window-bl";var a=document.createElement("div");a.className="x-window-br";var d=document.createElement("div");d.className="x-window-bc";var f=document.createElement("div");f.className="x-window-footer";g.appendChild(a);a.appendChild(d);d.appendChild(f);this.wraparea.appendChild(g);return c};TableFigure.prototype.setDimension=function(a,b){draw2d.Figure.prototype.setDimension.call(this,a,b);if(this.titlebar!=null){this.titlebar.style.width=(this.getWidth()-6)+"px"}if(this.wraparea!=null){if(this.xbody!=null){this.xbody.style.height=(this.getHeight()-20)+"px"}if(this.scrollarea!=null){this.scrollarea.style.height=this.xbody.style.height;this.scrollarea.style.width=this.getWidth()-14+"px"}}for(key in this.children){var c=this.children[key];c.setDimension(this.getWidth(),c.getHeight())}if(this.portTop!=null){this.portTop.setPosition(this.getWidth()/2,0);this.portRight.setPosition(this.getWidth(),this.getHeight()/2+3);this.portBottom.setPosition(this.getWidth()/2,this.getHeight()+7);this.portLeft.setPosition(0,this.getHeight()/2+3)}};TableFigure.prototype.addChild=function(a){this.children[a.id]=a;this.length=this.length+1;a.html.style.overflowX="hidden";a.html.style.overflowY="hidden";a.html.style.overflow="hidden";a.html.style.paddingLeft="0px";a.html.style.paddingRight="0px";a.html.style.left="1px";a.html.style.textAlign="left";a.classStyle="x-form-field";a.html.style.cursor="default";a.html.style.width="100%";a.html.height="20px";this.scrollarea.appendChild(a.getHTMLElement())};TableFigure.prototype.getChild=function(a){return this.children[a]};TableFigure.prototype.expand=function(){this.tool.className="x-tool x-tool-toggle x-tool-minimize";this.resizeable=true;this.scrollarea.style.visibility="";this.setDimension(this.width,25+20*(this.length));this.open=true};TableFigure.prototype.collapse=function(){this.tool.className="x-tool x-tool-toggle x-tool-maximize";this.scrollarea.style.visibility="hidden";this.resizeable=false;this.setDimension(this.width,25);this.open=false};TableFigure.prototype.onDragstart=function(a,c){var b=draw2d.WindowFigure.prototype.onDragstart.call(this,a,c);if(a<this.width&&a>(this.width-20)&&c<20){if(this.open==true){this.open=false;this.collapse()}else{this.open=true;this.expand()}return false}return b};TableFigure.prototype.addKeyColumn=function(a,c){var b=new draw2d.Label("");b.type=c;b.columnName=a;b.key=true;b.setPosition(0,20*this.length+8);b.setStyledText('<img src="icons/table_key.png" style="margin-left:4px;margin-right:5px;vertical-align:middle;border:0px" border="0" /><span class="x-form-field" style="font-size:11px;font-weight:bold">'+a+"</span>");this.addChild(b)};TableFigure.prototype.addColumn=function(b,e,d){var c=new draw2d.Label("");c.columnName=b;c.key=d;c.setPosition(0,20*this.length+8);c.type=e;var f=Ext.BLANK_IMAGE_URL;if(e!=null){if(e=="char"){f="icons/font.png"}else{if(e=="number"){f="icons/star.png"}else{if(e=="date"){f="icons/date.png"}else{if(e=="time"){f="icons/time.png"}else{if(e=="binary"){f="icons/attach.png"}else{f="icons/database_table.png"}}}}}}var a;if(d){a='<img width="16" height="16" src="icons/table_key.png" style="margin-left:4px;margin-right:0px;vertical-align:middle;border:0px" border="0" /><img src="'+f+'" width="16" height="16" style="margin-left:4px;margin-right:5px;vertical-align:middle;border:0px" border="0" /><span class="x-form-field" style="font-size:11px;font-weight:bold">'+b+"</span>"}else{a='<img width="16" height="16" src='+Ext.BLANK_IMAGE_URL+' style="margin-left:4px;margin-right:0px;vertical-align:middle;border:0px"  border="0"  /><img src="'+f+'" width="16" height="16" style="margin-left:4px;margin-right:5px;vertical-align:middle;border:0px" border="0" /><span  style="font-size:11px" class="x-form-field">'+b+"</span>"}c.setStyledText(a);this.addChild(c)};TableFigure.prototype.autoSize=function(){this.setDimension(200,25+20*(this.length))};TableFigure.prototype.addColumns=function(a){ilength=a.length;for(var b=0;b<ilength;b++){this.addColumn(a[b].cname,a[b].type,a[b].key=="1"?true:false)}this.autoSize()};TableFigure.prototype.serialize=function(){var b=new Object();b.x=this.x;b.y=this.y;b.width=this.getWidth();b.height=this.getHeight();b.open=this.open;b.title=this.title;b.length=this.length;var a=[];for(key in this.children){var d=this.children[key];var c=new Object();c.columnName=d.columnName;c.key=d.key;c.type=d.type;a.push(c)}b.children=a;return b};TableCommandDelete=function(a){this.parent=a.parent;this.figure=a;this.workflow=a.workflow;this.connections=null;this.compartmentDeleteCommands=null};TableCommandDelete.prototype=new draw2d.Command;TableCommandDelete.prototype.type="TableCommandDelete";TableCommandDelete.prototype.execute=function(){this.redo()};TableCommandDelete.prototype.undo=function(){if(this.figure instanceof draw2d.CompartmentFigure){for(var b=0;b<this.compartmentDeleteCommands.getSize();b++){var a=this.compartmentDeleteCommands.get(b);this.figure.addChild(a.figure);this.workflow.getCommandStack().undo()}}this.workflow.addFigure(this.figure);if(this.figure instanceof draw2d.Connection){this.figure.reconnect()}this.workflow.setCurrentSelection(this.figure);if(this.parent!=null){this.parent.addChild(this.figure)}for(var b=0;b<this.connections.getSize();++b){this.workflow.addFigure(this.connections.get(b));this.connections.get(b).reconnect()}};TableCommandDelete.prototype.redo=function(){if(this.figure instanceof draw2d.CompartmentFigure){if(this.compartmentDeleteCommands==null){this.compartmentDeleteCommands=new draw2d.ArrayList();var a=this.figure.getChildren().clone();for(var c=0;c<a.getSize();c++){var e=a.get(c);this.figure.removeChild(e);var b=new draw2d.CommandDelete(e);this.compartmentDeleteCommands.add(b);this.workflow.getCommandStack().execute(b)}}else{for(var c=0;c<this.compartmentDeleteCommands.getSize();c++){this.workflow.redo()}}}this.workflow.removeFigure(this.figure);this.workflow.setCurrentSelection(null);if(this.figure instanceof TableFigure&&this.connections==null){this.connections=new draw2d.ArrayList();var d=this.figure.getPorts();for(var c=0;c<d.getSize();c++){if(d.get(c).getConnections){this.connections.addAll(d.get(c).getConnections())}}}if(this.connections==null){this.connections=new draw2d.ArrayList()}if(this.parent!=null){this.parent.removeChild(this.figure)}for(var c=0;c<this.connections.getSize();++c){this.workflow.removeFigure(this.connections.get(c))}};TableFigure.prototype.createCommand=function(a){if(a.getPolicy()==draw2d.EditPolicy.DELETE){if(!this.isDeleteable()){return null}return new TableCommandDelete(this)}draw2d.Figure.prototype.createCommand.call(this,a)};TableMenu=function(){draw2d.Menu.call(this)};TableMenu.prototype=new draw2d.Menu();TableMenu.prototype.createHTMLElement=function(){var a=document.createElement("div");a.style.position="absolute";a.style.left=this.x+"px";a.style.top=this.y+"px";a.style.margin="0px";a.style.padding="0px";a.style.zIndex=""+draw2d.Figure.ZOrderBaseIndex;a.style.border="1px solid gray";a.style.cursor="pointer";a.className="x-menu";this.ul=document.createElement("ul");this.ul.className="x-menu-list";a.appendChild(this.ul);return a};TableMenu.prototype.createList=function(){this.dirty=false;var f=this;for(var e=0;e<this.menuItems.getSize();e++){var g=this.menuItems.get(e);var b=document.createElement("li");if(g.getLabel()!=null){b.className="x-menu-list-item";var c=document.createElement("a");c.className="x-menu-item";b.appendChild(c);var d=document.createElement("img");d.className="x-menu-item-icon";if(g.iconUrl!=null){d.src=g.iconUrl}else{d.src=Ext.BLANK_IMAGE_URL}c.appendChild(d);var j=document.createTextNode(g.getLabel());c.appendChild(j);this.ul.appendChild(b);b.menuItem=g;c.menuItem=g;if(b.addEventListener){b.addEventListener("click",function(m){var k=arguments[0]||window.event;k.cancelBubble=true;k.returnValue=false;var l=k.clientX;var a=k.clientY;var o=document.body.parentNode.scrollLeft;var n=document.body.parentNode.scrollTop;this.menuItem.execute(l+o,a+n)},false);b.addEventListener("mouseup",function(a){a.cancelBubble=true;a.returnValue=false},false);b.addEventListener("mousedown",function(a){a.cancelBubble=true;a.returnValue=false},false);b.addEventListener("mouseover",function(a){this.className="x-menu-list-item x-menu-item-active"},false);b.addEventListener("mouseout",function(a){this.className="x-menu-list-item"},false)}else{if(b.attachEvent){b.attachEvent("onclick",function(m){var k=arguments[0]||window.event;var l=k.clientX;var a=k.clientY;var o=document.body.parentNode.scrollLeft;var n=document.body.parentNode.scrollTop;k.cancelBubble=true;k.returnValue=false;k.srcElement.menuItem.execute(l+o,a+n)});b.attachEvent("onmousedown",function(a){a.cancelBubble=true;a.returnValue=false});b.attachEvent("onmouseup",function(a){a.cancelBubble=true;a.returnValue=false});b.attachEvent("onmouseover",function(a){a.srcElement.style.className="x-menu-list-item x-menu-item-active"});b.attachEvent("onmouseout",function(a){a.srcElement.style.className="x-menu-list-item"})}}}else{b.className="x-menu-list-item x-menu-sep-li";var h=document.createElement("span");h.className="x-menu-sep";h.innerHTML="&#160;";b.appendChild(h);this.ul.appendChild(b)}}};TableFigure.prototype.getContextMenu=function(){var b=new TableMenu();var a=this;b.appendMenuItem(new draw2d.MenuItem("To Front","icons/shape_move_forwards.png",function(){a.workflow.moveFront(a)}));b.appendMenuItem(new draw2d.MenuItem("To Back","icons/shape_move_backwards.png",function(){a.workflow.moveBack(a)}));b.appendMenuItem(new draw2d.MenuItem(null,null,null));b.appendMenuItem(new draw2d.MenuItem("Delete","icons/shape_square_delete.png",function(){a.onKeyDown(46,false)}));return b};TableConnection.prototype.serialize=function(){var a=new Object();a.source=this.sourcePort.parentNode.title;a.target=this.targetPort.parentNode.title;return a};function FormGridFactory(){}function formgridbutton(a){if(a.id=="next"){if(a.formGrid.rowIndex<a.formGrid.myData.length-1){a.formGrid.rowIndex=a.formGrid.rowIndex+1}}else{if(a.id=="prev"){if(a.formGrid.rowIndex>0){a.formGrid.rowIndex=a.formGrid.rowIndex-1}}else{if(a.id=="first"){a.formGrid.rowIndex=0}else{a.formGrid.rowIndex=a.formGrid.myData.length-1}}}var c=[];if(a.formGrid.myData.length>0){for(i=0;i<a.formGrid.meta.length;i++){var b=[];b.push(a.formGrid.meta[i]["l"]);b.push(a.formGrid.myData[a.formGrid.rowIndex][i]);c.push(b)}}a.formGrid.store.loadData(c)}FormGridFactory.prototype.build=function(d,f,c){var a=new Ext.data.SimpleStore({fields:[{name:"column",sortable:false},{name:"value",sortable:false}]});var h=new Ext.Toolbar({items:[]});var g=0;var e=true;var b=new Ext.grid.GridPanel({store:a,formTB:h,columns:[{header:"Column",dataIndex:"column",renderer:defaultRenderer},{header:"Value",dataIndex:"value",width:250,renderer:defaultRenderer}],stripeRows:true,myData:c,meta:f,queryID:d,rowIndex:g,additionalData:function(j,k){},refreshData:function(j){var l=[];this.rowIndex=0;if(this.myData.length>0){for(i=0;i<this.meta.length;i++){var k=[];k.push(this.meta[i]["l"]);k.push(this.myData[this.rowIndex][i]);l.push(k)}}this.store.loadData(l)},listeners:{render:function(){if(e){gridnext=new Ext.Toolbar.Button({cls:"x-btn-icon",icon:"icons/resultset_next.png",tooltip:"<b>Next Record</b>",handler:formgridbutton,id:"next",formGrid:this});gridprev=new Ext.Toolbar.Button({cls:"x-btn-icon",icon:"icons/resultset_previous.png",tooltip:"<b>Previous Record</b>",handler:formgridbutton,id:"prev",formGrid:this});gridfirst=new Ext.Toolbar.Button({cls:"x-btn-icon",icon:"icons/resultset_first.png",tooltip:"<b>First Record</b>",handler:formgridbutton,id:"first",formGrid:this});gridlast=new Ext.Toolbar.Button({cls:"x-btn-icon",icon:"icons/resultset_last.png",tooltip:"<b>Last Available Record</b>",handler:formgridbutton,id:"last",formGrid:this});this.formTB.add(gridfirst);this.formTB.add(gridprev);this.formTB.add(gridnext);this.formTB.add(gridlast);e=false}var k=[];this.rowIndex=0;if(this.myData.length>0){for(i=0;i<this.meta.length;i++){var j=[];j.push(this.meta[i]["l"]);j.push(this.myData[this.rowIndex][i]);k.push(j)}}this.store.loadData(k)}},bbar:h});return b};FormGridFactory.prototype.name=function(){return"Form"};sqlResultPluginFactories.push(new FormGridFactory());var sqlTableTemplate=new Ext.XTemplate('<table class="sqltable">','<thead><tr><tpl for="meta">','<th class="sqlth">{[this.encode(values["l"])]}</th>',"</tpl></tr></thead>",'<tpl for="data"><tr><tpl for=".">','<td class="sqltd" align="">{[this.encode(values)]}</td>',"</tpl></tr></tpl></table>",{encode:function(a){return Ext.util.Format.htmlEncode(a)}});sqlTableTemplate.compile();function HTMLGridFactory(){}HTMLGridFactory.prototype.build=function(b,c,a){return new Ext.Panel({html:"",autoScroll:true,myData:a,queryID:b,meta:c,loaded:false,listeners:{render:function(){this.loaded=true;var d=new Object();d.data=this.myData;d.meta=this.meta;sqlTableTemplate.overwrite(this.body,d,true)}},additionalData:function(e,f){if(this.loaded){var d=new Object();d.data=this.myData;d.meta=this.meta;sqlTableTemplate.overwrite(this.body,d,true)}},refreshData:function(e){if(this.loaded){var d=new Object();d.data=this.myData;d.meta=this.meta;sqlTableTemplate.overwrite(this.body,d,true)}}})};HTMLGridFactory.prototype.name=function(){return"HTML"};sqlResultPluginFactories.push(new HTMLGridFactory());Ext.Ajax.timeout=60000;var dynTabsArray=new Object();var dynMenuArray=new Object();var loaded_plugin_scripts=new Object();var southPanel;var printingWindow;Array.prototype.clear=function(){this.length=0};var sqlPrintingTableTemplate=new Ext.XTemplate('<table class="sqltable">','<thead><tr><tpl for="meta">','<th class="sqlth">{[this.encode(values["l"])]}</th>',"</tpl></tr></thead>",'<tpl for="data"><tr><tpl for=".">','<td class="sqltd">{[this.encode(values)]}</td>',"</tpl></tr></tpl></table>",{encode:function(a){return Ext.util.Format.htmlEncode(a)}});TreeStoreLoader=function(b){this.nodeParamName="node";this.dataUrl=true;Ext.apply(this,b);if(!this.dataFields){this.dataFields=["id","text","children","leaf","type","cls","qname"]}for(var c=0,a=this.dataFields.length;c<a;c++){if(typeof this.dataFields[c]=="string"){this.dataFields[c]={name:this.dataFields[c]}}}if(!this.store){this.store=new Ext.data.JsonStore({url:this.dataUrl,root:this.dataRoot,fields:["text"]})}TreeStoreLoader.superclass.constructor.call(this)};Ext.extend(TreeStoreLoader,Ext.tree.TreeLoader,{requestData:function(a,b){if(this.fireEvent("beforeload",this,a,b)!==false){this.store.purgeListeners();this.store.on("load",this.handleResponse.createDelegate(this,[a,b],0));this.store.on("loadexception",this.handleFailure.createDelegate(this,[a,b],0));this.store.load({params:this.getParams(a),callback:b})}else{if(typeof b=="function"){b()}}},getParams:function(c){var d={};var b=this.baseParams;for(var a in b){if(typeof b[a]!="function"){d[a]=b[a]}}d[this.nodeParamName]=c.id;return d},processResponse:function(a,c){try{this.addChildren(a);if(typeof c=="function"){c()}}catch(b){this.handleFailure(a,c)}},handleResponse:function(a,b){this.transId=false;this.processResponse(a,b);this.fireEvent("load",this,a)},handleFailure:function(a,b){this.transId=false;this.fireEvent("loadexception",this,a);if(typeof b=="function"){b(this,a)}},addChildren:function(a){this.store.each(function(b){a.appendChild(this.createChild(b))},this);if(a.attributes.expanded===true){a.expand()}},createChild:function(d){var a={};for(var b=0,c=this.dataFields;b<c.length;b++){a[c[b].name]=Ext.isEmpty(c[b].mapping)?d.get(c[b].name):((typeof c[b].mapping=="function")?c[b].mapping(d):d.get(c[b].mapping))}return this.createNode(a)}});var httpDatabasesProxy=new Ext.data.HttpProxy({url:"do?action=getDatabases",method:"POST"});var databasesReader=new Ext.data.JsonReader({root:"result.databases",id:"id"},["id","iconurl","name","hasCatalogs","catalogs","catalog","autocommit"]);var databasesDataStore=new Ext.data.Store({proxy:httpDatabasesProxy,reader:databasesReader});databasesDataStore.load();var httpSourcesProxy=new Ext.data.HttpProxy({url:"do?action=getSources",method:"POST"});var httpTreeProxy=new Ext.data.HttpProxy({url:"do?action=getTree",method:"POST"});var treeReader=new Ext.data.JsonReader({root:"result.nodes",id:"id"},["id","text","leaf","type","cls","qname"]);var sourcesReader=new Ext.data.JsonReader({root:"result.sources",id:"id"},["id","iconurl","sourceName","jdbcUrl","driverid","userName"]);var sourcesDataStore=new Ext.data.Store({proxy:httpSourcesProxy,reader:sourcesReader});var httpDriverProxy=new Ext.data.HttpProxy({url:"do?action=getDrivers",method:"POST"});var driverReader=new Ext.data.JsonReader({root:"result.drivers",id:"id"},["id","drvname","drvclassname","exampleurl","valid","icon"]);var driversDataStore=new Ext.data.Store({proxy:httpDriverProxy,reader:driverReader});var _counter=0;var preferredLayout=0;var queryTextPanel;function nextCounter(){return _counter++}function defaultRenderer(a){return Ext.util.Format.htmlEncode(a)}var homePage=new Ext.Panel({autoScroll:true,border:false,title:"<img src='icons/house.png' style='vertical-align:bottom;height:16px;width:16px' />&nbsp;&nbsp;Home"});var tabpanelpages=new Ext.TabPanel({region:"center",border:false,id:"tabpanelpages",tabPosition:"top",activeTab:0,deferredRender:false,items:[homePage]});var xSourceTempl=new Ext.XTemplate('<tpl for=".">','<div class="x-combo-list-item" style="cursor:default;" id="{id}"><img src="{iconurl}" onerror="this.src=\'icons/database.png\'" style="vertical-align:middle;width:16px;height:16px;margin-right:5px" />{sourceName}</div>',"</tpl>",'<div class="x-clear"></div>');var xdriverTempl=new Ext.XTemplate('<tpl for=".">','<div class="x-combo-list-item" style="cursor:default;" id="{id}">','<img src="{icon}" onerror="this.src=\'icons/database.png\'" style="vertical-align:middle;width:16px;height:16px" />',' <tpl if="valid">',"<span style='font-weight: bolder'>{drvname}</span>","</tpl>",' <tpl if="!valid">',"<span><s>{drvname}</s></span>","</tpl>","</div>","</tpl>",'<div class="x-clear"></div>');var srcDrvTpl=new Ext.XTemplate('<tpl for="."><div class="x-combo-list-item"><img src="{icon}" onerror="this.src=\'icons/database.png\'" style="vertical-align:middle;width:16px;height:16px;margin-right:5px" /><tpl if="valid"><span style=\'font-weight: bolder\'>{drvname}</span></tpl><tpl if="!valid"><s>{drvname}</s></tpl></div></tpl>');var sourcesview;var driversview;var outlineTempl=new Ext.XTemplate('<tpl for=".">','<div class="x-combo-list-item" style="cursor:default;" >{title}</div>',"</tpl>",'<div class="x-clear"></div>');var xConnTempl=new Ext.XTemplate('<tpl for=".">','<div class="x-combo-list-item" style="cursor:default;" id="{id}"><img src="{iconurl}" onerror="this.src=\'icons/database.png\'" style="vertical-align:middle;width:16px;height:16px;margin-right:5px" />{name}</div>',"</tpl>",'<div class="x-clear"></div>');var menu_newconnection;function commitConnection(c){var a=databasesDataStore.getAt(connection_menu.rowid);var b=a.get("id");commitConnectionImpl(b)}function commitConnectionImpl(a){new Ext.data.Connection().request({url:"do?action=commitConnection&sessionid="+a,method:"post",scope:this,params:this.baseParams,failure:requestFailed})}function rollbackConnection(c){var a=databasesDataStore.getAt(connection_menu.rowid);var b=a.get("id");rollbackConnectionImpl(b)}function rollbackConnectionImpl(a){new Ext.data.Connection().request({url:"do?action=rollbackConnection&sessionid="+a,method:"post",scope:this,params:this.baseParams,failure:requestFailed})}function closeConnection(c){var a=databasesDataStore.getAt(connection_menu.rowid);var b=a.get("id");new Ext.data.Connection().request({url:"do?action=closeConnection&sessionid="+b,method:"post",scope:this,params:this.baseParams,callback:function(f,e,d){databasesDataStore.reload()}})}function createPage(){Ext.QuickTips.init();httpSourcesProxy.getConnection().on("requestexception",requestFailed);var a=createSourceMenu();var b=createDriverMenu();sourcesview=new Ext.DataView({tpl:xSourceTempl,emptyText:'<div style="overflow: hidden;padding:5px"><b>No sources yet</b><div style="overflow: hidden;margin-left:5px;margin-top:5px">You have to define at least one source in order to connect to your database.<br/><br/><a href="#" onclick="newsourcesPanel()"><img style="border:0;text-decoration: none;width:16px;height:16px;vertical-align:middle;margin-right:5px" src="icons/transmit_add.png"/>Create a new source</a></div></div><div class="x-clear"></div>',singleSelect:true,selectedClass:"ydataview-selected",store:sourcesDataStore,itemSelector:"div.x-combo-list-item",deferEmptyText:false});driversview=new Ext.DataView({tpl:xdriverTempl,emptyText:"No Driver yet",singleSelect:true,selectedClass:"ydataview-selected",store:driversDataStore,itemSelector:"div.x-combo-list-item",deferEmptyText:false});sourcesview.on("contextmenu",function(g,f,k,j){j.stopEvent();sourcesview.select(k);a.rowid=f;var h=j.getXY();a.showAt([h[0]-50,h[1]])});driversview.on("contextmenu",function(g,f,k,j){j.stopEvent();driversview.select(k);b.rowid=f;var h=j.getXY();b.showAt([h[0]-50,h[1]])});sourcesview.on("dblclick",function(g,f,j,h){h.stopEvent();openConnectionDialog(sourcesDataStore.getAt(f))});driversview.on("dblclick",function(g,f,j,h){h.stopEvent()});menu_newconnection=new Ext.menu.Menu({items:[]});menu_newconnection.on("beforeshow",function(){menu_newconnection.removeAll();for(var e=0;e<sourcesDataStore.getCount();e++){menu_newconnection.addMenuItem(new Ext.menu.Item({text:sourcesDataStore.getAt(e).get("sourceName"),idx:e,icon:"icons/database.png",handler:function(){openConnectionDialog(sourcesDataStore.getAt(this.idx))}}))}menu_newconnection.addSeparator();menu_newconnection.addMenuItem(new Ext.menu.Item({text:"New Source...",icon:"icons/user_add.png",handler:newsourcesPanel}));menu_newconnection.addSeparator();menu_newconnection.addMenuItem(new Ext.menu.Item({text:"New SQL Editor",icon:"icons/page_edit.png",handler:function(){newEditor("")}}))});connection_menu=new Ext.menu.Menu({items:[]});connectionsview=new Ext.DataView({emptyText:'<div style="margin:5px"><span><b>No connections yet</b></span><br/><br/>You can connect to any defined source</div><div class="x-clear"></div>',tpl:xConnTempl,singleSelect:true,selectedClass:"ydataview-selected",store:databasesDataStore,itemSelector:"div.x-combo-list-item",deferEmptyText:false});connectionsview.on("contextmenu",function(h,f,l,k){k.stopEvent();connectionsview.select(l);connection_menu.rowid=f;var j=k.getXY();connection_menu.removeAll();var g=databasesDataStore.getAt(connection_menu.rowid);connection_menu.addMenuItem(new Ext.menu.Item({text:"New SQL Editor",icon:"icons/page_edit.png",handler:function(){var e=newEditor("");e.tb.cmb.setValue(g.get("id"));e.tb.catcmb.setValue(g.get("catalog"))}}));connection_menu.addSeparator();connection_menu.addMenuItem(new Ext.menu.Item({text:"Close Connection",icon:"icons/disconnect.png",handler:closeConnection}));if(g.get("autocommit")==false){connection_menu.addSeparator();connection_menu.addMenuItem(new Ext.menu.Item({text:"Commit",icon:"icons/database_save.png",handler:commitConnection}));connection_menu.addMenuItem(new Ext.menu.Item({text:"Rollback",icon:"icons/arrow_undo.png",handler:rollbackConnection}))}connection_menu.showAt([j[0]-50,j[1]])});sourcesDataStore.on("load",d);sourcesDataStore.on("loadexception",c);driversDataStore.on("load",d);driversDataStore.on("loadexception",c);function d(e,g,f){}function c(j,h,e,g){var f=Ext.util.JSON.decode(e.responseText);Ext.MessageBox.show({title:"Error Message",msg:f.error,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}viewport=createViewport();viewport.doLayout();homePage.load({nocache:true,url:"home.jsp",scripts:true});sourcesDataStore.load();driversDataStore.load();document.getElementById("loading-msg").innerHTML="Done.";setTimeout(function(){Ext.get("loading").remove();Ext.get("loading-mask").fadeOut({remove:true,duration:1.5})},250);Ext.TaskMgr.start({run:function(){new Ext.data.Connection().request({url:"do?action=ping",method:"post",scope:this})},interval:120000})}function createViewport(){var d=new Ext.Panel({items:sourcesview,id:"eastaliases",title:"<img src='icons/transmit.png' style='vertical-align:bottom;height:16px;width:16px' />&nbsp;Sources",autoScroll:true,containerScroll:false,layout:"fit",border:false,tbar:[{tooltip:"<b>New Source</b><br/>Create a new source",icon:"icons/transmit_add.png",cls:"x-btn-icon",handler:newsourcesPanel}]});var f=new Ext.Panel({items:driversview,id:"eastdrivers",title:"<img src='icons/application.png' style='vertical-align:bottom;height:16px;width:16px' />&nbsp;Drivers",layout:"fit",autoScroll:true,border:false,tbar:[{tooltip:"<b>New driver</b><br/>Create a new driver",icon:"icons/application_add.png",cls:"x-btn-icon",handler:newdriversPanel}]});var e=new Ext.Panel({items:connectionsview,id:"eastconnections",title:"<img src='icons/database.png' style='vertical-align:bottom;height:16px;width:16px' />&nbsp;Connections",border:false,autoScroll:true,tbar:[{cls:"x-btn-text-icon",text:"New Connection...",menu:menu_newconnection,style:"width:20px",icon:"icons/database_lightning.png"}]});southPanel=new Ext.TabPanel({region:"south",border:false,id:"southPanel",minTabWidth:115,border:false,tabWidth:135,enableTabScroll:false,border:false,height:250,split:true});var b=createTree();var c=new Ext.Toolbar.Button({cls:"x-btn-icon",icon:"icons/report.png",tooltip:"<b>Export [Not yet implemented]</b><br/>Export details....",handler:function(){}});var a=new Ext.Viewport({renderTo:Ext.getBody(),layout:"border",items:[{region:"center",layout:"border",border:false,items:[tabpanelpages]},{region:"west",title:"<img src='icons/database.png' style='vertical-align:bottom;height:16px;width:16px' />&nbsp;Database View",width:280,split:true,collapsible:true,titleCollapse:true,border:false,layout:"fit",items:b},{region:"south",title:"<img src='icons/application_view_detail.png' style='vertical-align:bottom;height:16px;width:16px' />&nbsp;Details",height:200,split:true,collapsible:true,titleCollapse:true,items:southPanel,border:false,layout:"fit"},{region:"east",title:"<img src='icons/application_cascade.png' style='vertical-align:bottom;height:16px;width:16px' />&nbsp;Sources, Drivers, Active Connections",width:300,split:true,collapsible:true,titleCollapse:true,layout:"fit",border:false,items:[{xtype:"tabpanel",activeTab:0,deferredRender:false,items:[d,f,e]}]}]});return a}function editsourcesPanel(e){var a={width:600,height:300,shadow:true,minWidth:300,minHeight:250,modal:true,collapsible:false,closable:true,title:"Edit Source "+e.get("sourceName")};var b=new Ext.Window(a);b.addButton("Close",b.close,b);var c=new Ext.form.FormPanel({labelWidth:95,onSubmit:Ext.emptyFn,url:"do?action=updateSource",baseCls:"x-plain"});function f(g,h){b.close();sourcesDataStore.reload()}jdbcurl=new Ext.form.TextField({fieldLabel:"JDBC URL",name:"url",width:400,readOnly:false,allowBlank:false,value:e.get("jdbcUrl")});updateSourceDriverCombo=new Ext.form.ComboBox({fieldLabel:"Driver Name",store:driversDataStore,displayField:"drvname",valueField:"id",mode:"local",editable:false,triggerAction:"all",selectOnFocus:true,width:400,forceSelection:true,tpl:srcDrvTpl});updateSourceDriverCombo.on("select",function(j,h,g){jdbcurl.setValue(h.get("exampleurl"))});updateSourceDriverCombo.setValue(e.get("driverid"));c.add(new Ext.form.TextField({fieldLabel:"Source Name",name:"sourceName",width:400,readOnly:false,allowBlank:false,value:e.get("sourceName")}),jdbcurl,updateSourceDriverCombo,new Ext.form.TextField({fieldLabel:"User Name",name:"user",width:400,readOnly:false,allowBlank:true,value:e.get("userName")}));function d(){if(c.form.isValid()){c.form.submit({params:{driverid:updateSourceDriverCombo.getValue(),sourceid:e.get("id")},waitMsg:"Updating Source...",failure:submitFailed,success:f})}else{Ext.MessageBox.show({title:"Error",msg:"Please fix the errors noted.",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}}b.addButton("Update",d,b);b.show();c.render(b.body)}function editdriversPanel(d){var a={width:600,height:300,shadow:true,minWidth:300,minHeight:250,modal:true,collapsible:false,closable:true,title:"Edit Driver "+d.get("drvname")};var b=new Ext.Window(a);b.addButton("Close",b.close,b);var c=new Ext.form.FormPanel({labelWidth:95,url:"do?action=updateDriver",baseCls:"x-plain"});c.on("actioncomplete",function(f,g){if(g.result.success===true){driversDataStore.reload();b.close()}});c.on("actionfailed",function(f,g){Ext.MessageBox.show({title:"Error",msg:g.result.error,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})});c.add(new Ext.form.TextField({fieldLabel:"Driver Name",name:"drivername",width:400,readOnly:false,allowBlank:false,value:d.get("drvname")}),new Ext.form.TextField({fieldLabel:"Driver Class",name:"driverclass",width:400,readOnly:false,allowBlank:false,value:d.get("drvclassname")}),new Ext.form.TextField({fieldLabel:"Example URL",name:"exampleurl",width:400,readOnly:false,allowBlank:true,value:d.get("exampleurl")}));function e(){c.form.submit({params:{driverid:d.get("id")},waitMsg:"Updating Driver..."})}b.addButton("Update",e,b);b.show();c.render(b.body)}function requestFailed(b,a,c){Ext.MessageBox.show({title:"Error",msg:"Status: "+a.status+", Status Text: "+a.statusText,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}function newsourcesPanel(){var b={width:500,height:250,shadow:true,minWidth:300,minHeight:250,modal:true,collapsible:false,closable:true,title:"New Source"};var c=new Ext.Window(b);c.addButton("Close",c.close,c);var d=new Ext.form.FormPanel({labelWidth:95,url:"do?action=createSource",onSubmit:Ext.emptyFn,baseCls:"x-plain"});var e=new Ext.form.ComboBox({fieldLabel:"Driver Name",store:driversDataStore,displayField:"drvname",valueField:"id",mode:"local",editable:false,triggerAction:"all",selectOnFocus:true,width:300,forceSelection:true,tpl:srcDrvTpl});var a=new Ext.form.TextField({fieldLabel:"JDBC URL",name:"url",width:300,readOnly:false,allowBlank:false});d.add(new Ext.form.TextField({fieldLabel:"Source Name",name:"sourceName",width:300,readOnly:false,allowBlank:false}),a,e,new Ext.form.TextField({fieldLabel:"User Name",name:"user",width:300,readOnly:false,allowBlank:true}));function g(){if(d.form.isValid()){d.form.submit({params:{driverid:e.getValue()},waitMsg:"Creating Source...",failure:submitFailed,success:f})}else{Ext.MessageBox.show({title:"Error",msg:"Please fix the errors noted.",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}}function f(h,j){sourcesDataStore.reload();c.close()}c.addButton("Create",g,c);c.show();d.render(c.body)}function newdriversPanel(){var a={width:500,height:200,shadow:true,minWidth:300,minHeight:150,modal:true,collapsible:false,closable:true,title:"New driver"};var b=new Ext.Window(a);b.addButton("Close",b.close,b);var c=new Ext.form.FormPanel({labelWidth:95,url:"do?action=createDriver",baseCls:"x-plain",onSubmit:Ext.emptyFn});c.add(new Ext.form.TextField({fieldLabel:"Driver Name",name:"drivername",width:300,readOnly:false,allowBlank:false,value:""}),new Ext.form.TextField({fieldLabel:"Driver Class",name:"driverclass",width:300,readOnly:false,allowBlank:false,value:""}),new Ext.form.TextField({fieldLabel:"Example URL",name:"exampleurl",width:300,readOnly:false,allowBlank:true,value:""}));function e(){if(c.form.isValid()){c.form.submit({params:{},waitMsg:"Creating New Driver...",failure:submitFailed,success:d})}}function d(f,g){driversDataStore.reload();b.close()}b.addButton("Create",e,b);b.show();c.render(b.body)}function submitFailed(b,c){var a="Error occurred.";if(c.failureType==Ext.form.Action.LOAD_FAILURE){a=c.result.message}else{if(c.failureType==Ext.form.Action.CONNECT_FAILURE){a="Status: "+c.response.status+", Status Text: "+c.response.statusText}else{if(c.failureType==Ext.form.Action.SERVER_INVALID){a=c.result.message}else{if(c.failureType==Ext.form.Action.CLIENT_INVALID){a="Please fix any and all validation errors."}else{a=c.result.error}}}}Ext.MessageBox.show({title:"Error",msg:a,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}function selectTreeFirst(){var b=treecombo.store.getCount();if(b>0){var a=treecombo.store.getAt(0);treecombo.setValue(a.get("id"));treecombo.fireEvent("select")}else{treecombo.setValue("");treecombo.fireEvent("select")}}function copySourcePanel(c){var a={width:600,height:300,shadow:true,minWidth:300,minHeight:250,modal:true,collapsible:false,closable:true,title:"Copy Source "+c.get("sourceName")};var b=new Ext.Window(a);b.addButton("Close",b.close,b);var d=new Ext.form.FormPanel({labelWidth:95,url:"do?action=createSource",baseCls:"x-plain",onSubmit:Ext.emptyFn});copyAliasDriverCombo=new Ext.form.ComboBox({fieldLabel:"Driver Name",store:driversDataStore,displayField:"drvname",valueField:"id",mode:"local",editable:false,triggerAction:"all",selectOnFocus:true,width:400,forceSelection:true});jdbcurl=new Ext.form.TextField({fieldLabel:"JDBC URL",name:"url",width:400,readOnly:false,allowBlank:false,value:c.get("jdbcUrl")});copyAliasDriverCombo.on("select",function(j,h,g){jdbcurl.setValue(h.get("exampleurl"))});copyAliasDriverCombo.setValue(c.get("driverid"));d.add(new Ext.form.TextField({fieldLabel:"Source Name",name:"source",width:400,readOnly:false,allowBlank:false,value:c.get("sourceName")}),copyAliasDriverCombo,jdbcurl,new Ext.form.TextField({fieldLabel:"User Name",name:"user",width:400,readOnly:false,allowBlank:true,value:c.get("userName")}));function e(){if(d.form.isValid()){d.form.submit({params:{driverid:copyAliasDriverCombo.getValue()},waitMsg:"Creating Source...",failure:submitFailed,success:f})}else{Ext.MessageBox.show({title:"Error",msg:"Please fix the errors noted.",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}}function f(g,h){databasesDataStore.reload();b.close()}b.addButton("Create Source",e,b);b.show();d.render(b.body)}function createSourceMenu(){var a=new Ext.menu.Menu({shadow:"frame",id:"sourceMenu",items:[new Ext.menu.Item({text:"Connect...",icon:"icons/database_lightning.png",handler:function(){openConnectionDialog(sourcesDataStore.getAt(a.rowid))}}),new Ext.menu.Item({text:"Edit...",icon:"icons/transmit_edit.png",handler:function(){editsourcesPanel(sourcesDataStore.getAt(a.rowid))}}),new Ext.menu.Item({text:"Copy Source...",icon:"icons/transmit_go.png",handler:function(){copySourcePanel(sourcesDataStore.getAt(a.rowid))}}),new Ext.menu.Item({text:"Delete...",icon:"icons/transmit_delete.png",handler:function(){function b(c){if(c=="yes"){new Ext.data.Connection().request({url:"do?action=deleteSource&id="+sourcesDataStore.getAt(a.rowid).get("id"),method:"post",scope:this,params:{},callback:function(f,e,d){sourcesDataStore.reload()}})}}Ext.MessageBox.confirm("Confirm","Are you sure you want to delete source "+sourcesDataStore.getAt(a.rowid).get("sourceName")+" ?",b)}})]});return a}function createDriverMenu(){var a=new Ext.menu.Menu({shadow:"frame",id:"driverMenu",items:[new Ext.menu.Item({text:"Edit...",icon:"icons/application_edit.png",handler:function(){editdriversPanel(driversDataStore.getAt(a.rowid))}}),new Ext.menu.Item({text:"Delete...",icon:"icons/application_delete.png",handler:function(){function b(c){if(c=="yes"){new Ext.data.Connection().request({url:"do?action=deleteDriver&id="+driversDataStore.getAt(a.rowid).get("id"),method:"post",scope:this,params:{},callback:function(f,e,d){driversDataStore.reload()}})}}Ext.MessageBox.confirm("Confirm","Are you sure you want to delete driver "+driversDataStore.getAt(a.rowid).get("driverName")+" ?",b)}})]});return a}function EditorPage(f){var c=new Logger();var g=new Ext.TabPanel({region:"center",tabPosition:"top",border:false,autoScroll:true,items:[c],deferredRender:true,logPanel:c});g.activate(c);g.on("remove",function(h,j){if(j.queryID){new Ext.data.Connection().request({url:"do?action=closeResultSet&rset="+j.queryID,method:"post",scope:this,params:this.baseParams})}});var b=new SqlEditor({border:false,width:1200,height:1200,minHeight:1200,initialText:f});if(f){editAreaLoader.setValue(b.id,f)}var e=createSQLToolbar(b,g);var d=new Ext.Panel({tbar:e,border:false,layout:"fit",items:[b]});var a=new Ext.Panel({sqlresultpanel:g,title:"<img src='icons/page_edit.png' style='vertical-align:bottom;height:16px;width:16px' />&nbsp;SQL Editor "+nextCounter(),layout:"border",closable:true,border:false,toolbar:e,execute:function(){this.toolbar.executeSQL()},hideMode:"offsets",items:[{region:"north",height:400,layout:"fit",split:true,autoScroll:true,items:[d]},{region:"center",split:true,layout:"fit",items:[g]}]});a.tb=e;e.editorPage=a;return a}function createSQLToolbar(k,b){var n=new Ext.Toolbar.Button({cls:"x-btn-icon",icon:"icons/page_white.png",tooltip:"<b>Clear</b><br/>Clear the Editor",handler:function(){editAreaLoader.setValue(k.id," ")}});var c=new Ext.form.ComboBox({store:databasesDataStore,displayField:"name",valueField:"id",typeAhead:false,editable:false,mode:"local",triggerAction:"all",selectOnFocus:true,width:135,forceSelection:true});var o=new Ext.data.SimpleStore({fields:["text"],data:[[]]});var e=new Ext.form.ComboBox({store:o,displayField:"text",valueField:"text",typeAhead:false,editable:false,mode:"local",triggerAction:"all",selectOnFocus:true,width:135,forceSelection:true,disabled:true});function h(){if(c.store==null){return}var t=c.store.getCount();if(t>0){var p=c.getValue();if(p&&p!=""){if(c.store.query("id",p).getCount()>0){}else{var s=c.store.getAt(0);c.setValue(s.get("id"))}}else{var s=c.store.getAt(0);c.setValue(s.get("id"))}c.fireEvent("select");if(c.run){c.run.enable()}}else{c.setValue("");c.fireEvent("select");if(c.run){try{c.run.disable()}catch(q){}}}}c.store.on("load",function(){h()});var g=new Ext.Toolbar.Button({cls:"x-btn-icon",tooltip:"<b>Commit</b>",icon:"icons/database_save.png",handler:function(){commitConnectionImpl(c.getValue())}});g.disable();var m=new Ext.Toolbar.Button({cls:"x-btn-icon",tooltip:"<b>Rollback</b>",icon:"icons/arrow_undo.png",handler:function(){rollbackConnectionImpl(c.getValue())}});m.disable();function f(){var t=c.getValue();if(t){var q=databasesDataStore.getById(t);if(q){if(q.get("autocommit")==false){g.enable();m.enable()}else{g.disable();m.disable()}var p=q.get("hasCatalogs");if(p){var s=q.get("catalogs");var w=[];for(i=0;i<s.length;i++){var v=[];v.push(s[i]);w.push(v)}o.loadData(w);e.enable();e.setValue(q.get("catalog"))}else{if(e.el){e.clearValue()}e.disable()}}else{if(e.el){e.clearValue()}e.disable()}}else{g.disable();m.disable();try{if(e.el){e.clearValue()}e.disable()}catch(u){}}}c.on("select",function(s,p,q){f()});e.on("select",function(){var q=c.getValue();var p=databasesDataStore.getById(q);p.set("catalog",e.getValue());new Ext.data.Connection().request({url:"do?action=changeCatalog",method:"post",params:{catalog:e.getValue(),sessionid:q}})});c.setValue(treecombo.getValue());f();function a(){var p="";p=editAreaLoader.getValue(k.id);b.logPanel.info2("Starting to execute",p);new Ext.data.Connection().request({url:"do?action=execute",method:"post",timeout:"3600000",params:{sql:p,sessionid:c.getValue()},failure:requestFailed,success:sqlSuccessful,sqlresultpanel:b})}var d=new Ext.Toolbar.Button({cls:"x-btn-icon",icon:"icons/lightning.png",tooltip:"<b>Run SQL</b><br/>Execute SQL text on server",handler:function(){a()}});var l=new Ext.Toolbar.Button({cls:"x-btn-icon",icon:"icons/lightbulb.png",tooltip:"<b>HighLight</b><br/>Syntax HighLight",enableToggle:true,pressed:true,handler:function(){editAreaLoader.toggle(k.id)}});var j=new Ext.Toolbar({executeSQL:a,listeners:{render:function(){this.addButton(n);this.addButton(l);this.addSeparator();this.add(c);this.add(e);this.addSeparator();this.addButton(d);this.addSeparator();this.addButton(g);this.addButton(m)}}});j.cmb=c;j.catcmb=e;return j}function sqlSuccessful(b,f){sqlresultpanel=f.sqlresultpanel;sqlresultpanel.logPanel.info("SQL Executed. Getting Response...");var z=Ext.util.JSON.decode(b.responseText);if(z.success){resultSets=z.result.resultSets;info=z.result.info;sqlresultpanel.logPanel.info("SQL Executed. Execution time: "+info[0]+" milliseconds. Executed statements: "+resultSets.length);for(ii=0;ii<resultSets.length;ii++){var t=z.result.resultSets[ii].meta;var k=z.result.resultSets[ii].data;var n=z.result.resultSets[ii].info;var g=n[0];var B=n[2];if(!B){sqlresultpanel.logPanel.error('"'+n[3]+'" executing: '+n[1]);sqlresultpanel.setActiveTab(sqlresultpanel.logPanel)}else{var e=createTableGrid(g,t,k);var y=[];y.push(e);for(var w=0;w<sqlResultPluginFactories.length;w++){var q=sqlResultPluginFactories[w].build(g,t,k);y.push(q)}var v=new Ext.Toolbar.Button({cls:"x-btn-icon",icon:"icons/resultset_next.png",tooltip:"<b>Next </b><br/>Get Additional Records",queryID:g,myData:k,resultPanels:y,handler:function(){this.disable();new Ext.data.Connection().request({url:"do?action=getAdditionalData",method:"post",params:{queryID:this.queryID},failure:requestFailed,success:sqlAdditionalSuccessful,sqlresultpanel:sqlresultpanel,myData:this.myData,next:this,resultPanels:this.resultPanels})}});var s=new Ext.Toolbar.Button({cls:"x-btn-icon",icon:"icons/resultset_next2.png",tooltip:"<b>Retrieve All </b><br/>Retrieve All Additional Records",queryID:g,myData:k,resultPanels:y,handler:function(){this.disable();new Ext.data.Connection().request({url:"do?action=getAdditionalData",method:"post",params:{all:1,queryID:this.queryID},failure:requestFailed,success:sqlAdditionalSuccessfulAll,sqlresultpanel:sqlresultpanel,myData:this.myData,nextAll:this,next:v,resultPanels:this.resultPanels})}});var h=new Ext.Toolbar.Button({cls:"x-btn-icon",icon:"icons/arrow_refresh.png",tooltip:"<b>Refresh </b><br/>Execute Again",queryID:g,myData:k,resultPanels:y,handler:function(){new Ext.data.Connection().request({url:"do?action=redoQuery",method:"post",params:{queryID:this.queryID},failure:requestFailed,success:sqlRefreshSuccessful,sqlresultpanel:sqlresultpanel,myData:this.myData,nextAll:s,next:v,resultPanels:this.resultPanels})}});var m=new Ext.layout.CardLayout({deferredRender:true,layoutOnCardChange:true});var o=new Ext.menu.Menu({});for(var x=0;x<y.length;x++){var a=preferredLayout==x?true:false;var A="Grid";if(x>0){A=sqlResultPluginFactories[x-1].name()}o.addMenuItem(new Ext.menu.CheckItem({sel:x,text:A,activePanel:y[x],checked:a,group:"sqllayout",clLayout:m,checkHandler:onLayoutCheck}))}var u=new Ext.Toolbar.Button({cls:"x-btn-icon",icon:"icons/printer.png",tooltip:"<b>Print </b><br/>Printable Version ",handler:function(){if(printingWindow&&printingWindow.open&&!printingWindow.closed){printingWindow.close()}printingWindow=window.open("","p","resizable=yes,width=600,height=400,toolbar=yes,scrollbars=yes,modal=yes");printingWindow.document.write('<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html><head><meta content="text/html; charset=UTF-8" http-equiv="Content-Type" /><link rel="stylesheet" type="text/css" href="print.css"/> <title>Printing...</title></head><body><input onclick="this.style.visibility=\'hidden\';window.print()" type="button" value="Print"/><div id="printingDiv"></div></body></html>');printingWindow.document.close();var j=new Object();j.data=k;j.meta=t;sqlPrintingTableTemplate.overwrite(printingWindow.document.getElementById("printingDiv"),j,true)}});var p=new Ext.Toolbar.Button({cls:"x-btn-icon",icon:"icons/database_table.png",tooltip:"<b>Export</b><br/>Export to CSV",handler:function(){if(!Ext.fly("frmCsvDummy")){var j=document.createElement("form");j.id="frmCsvDummy";j.name=id;j.className="x-hidden";j.target="_blank";document.body.appendChild(j)}Ext.Ajax.request({url:"do?action=csvExport",method:"POST",form:Ext.fly("frmCsvDummy"),isUpload:true,params:{action:"csvExport",meta:Ext.util.JSON.encode(t),data:Ext.util.JSON.encode(k),info:Ext.util.JSON.encode(n)}})}});var l=new Ext.Toolbar.Button({cls:"x-btn-icon",icon:"icons/page_white_acrobat.png",tooltip:"<b>Export</b><br/>Export to PDF",handler:function(){if(!Ext.fly("frmPdfDummy")){var j=document.createElement("form");j.id="frmPdfDummy";j.name=id;j.className="x-hidden";j.target="_blank";document.body.appendChild(j)}Ext.Ajax.request({url:"do?action=pdfExport",method:"POST",form:Ext.fly("frmPdfDummy"),isUpload:true,params:{action:"pdfExport",meta:Ext.util.JSON.encode(t),data:Ext.util.JSON.encode(k),info:Ext.util.JSON.encode(n)}})}});var d=new Ext.Toolbar.Button({cls:"x-btn-icon",icon:"icons/page_white_excel.png",tooltip:"<b>Export</b><br/>Export to Excel",handler:function(){var j=e.getExcelXml(true);if(Ext.isGecko3){document.location="data:application/vnd.ms-excel;Content-Disposition:attachment;filename=export_filename.xls;name=export.xls;base64,"+Base64.encode(j)}else{if(!Ext.fly("frmDummy")){var C=document.createElement("form");C.id="frmDummy";C.name=id;C.className="x-hidden";C.target="_blank";document.body.appendChild(C)}Ext.Ajax.request({url:"do?action=excelExport",method:"POST",form:Ext.fly("frmDummy"),isUpload:true,params:{action:"excelExport",ex:e.getExcelXml(true)}})}}});var c=new Ext.Panel({closable:true,title:"<img src='icons/table.png' style='vertical-align:bottom;height:16px;width:16px' >&nbsp;Results",autoScroll:true,border:false,items:y,layout:m,activeItem:preferredLayout,tbar:[v,s,{xtype:"tbseparator"},h,{xtype:"tbseparator"},{cls:"x-btn-icon",tooltip:"<b>Layout</b><br/>Choose Layout",menu:o,style:"width:20px",icon:"icons/layout.png"},{xtype:"tbseparator"},u,{xtype:"tbseparator"},d,l,p],queryID:g});sqlresultpanel.add(c);sqlresultpanel.doLayout(false);sqlresultpanel.setActiveTab(c)}}}else{sqlresultpanel.logPanel.error(z.error);Ext.MessageBox.show({title:"Error",msg:z.error,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}}function sqlRefreshSuccessful(a,c){sqlresultpanel=c.sqlresultpanel;sqlresultpanel.logPanel.info("SQL Executed. Getting Response...");var b=Ext.util.JSON.decode(a.responseText);if(b.success){c.next.enable();c.nextAll.enable();data=b.result.data;c.myData.clear();for(var d=0;d<data.length;d++){c.myData.push(data[d])}for(var d=0;d<c.resultPanels.length;d++){if(c.resultPanels[d].refreshData){c.resultPanels[d].refreshData(data)}}}else{sqlresultpanel.logPanel.error(b.error);Ext.MessageBox.show({title:"Error",msg:b.error,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}}Logger=function(){var a=new Ext.Template("<div class='x-log-entry'><div class='x-log-level x-log-{0:lowercase}'>{0:capitalize}</div><span class='x-log-time'>{2:date('H:i:s.u')}</span><span class='x-log-message'>{1}</span></div>");var b=new Ext.Template("<div class='x-log-entry'><div class='x-log-level x-log-{0:lowercase}'>{0:capitalize}</div><span class='x-log-time'>{2:date('H:i:s.u')}</span><span class='x-log-message'>{1}</span><span style='color:red'><strong>{3}</strong></span></div>");return Ext.apply(new Ext.Panel({title:"<img src='icons/application_xp_terminal.png' style='vertical-align:bottom;height:16px;width:16px' >&nbsp;Console",layout:"fit",border:false,autoScroll:true}),{fn:Ext.Template.prototype.insertFirst,toggleDirection:function(){if(this.fn===Ext.Template.prototype.insertFirst){this.fn=Ext.Template.prototype.append}else{this.fn=Ext.Template.prototype.insertFirst}},debug:function(c){this.fn.call(a,this.body,["debug",c,new Date()],true).scrollIntoView(this.body)},info:function(c){this.fn.call(a,this.body,["info",c,new Date()],true).scrollIntoView(this.body)},info2:function(d,c){this.fn.call(b,this.body,["info",d,new Date(),c],true).scrollIntoView(this.body)},warning:function(c){this.fn.call(a,this.body,["warning",c,new Date()],true).scrollIntoView(this.body)},error:function(c){this.fn.call(a,this.body,["error",c,new Date()],true).scrollIntoView(this.body)}})};SqlEditor=Ext.extend(Ext.form.Field,{readOnly:false,initialized:false,initComponent:function(){SqlEditor.superclass.initComponent.call(this);this.addEvents({initialize:true,activate:true})},focus:function(){},adjustSize:Ext.BoxComponent.prototype.adjustSize,onResize:function(a,b){SqlEditor.superclass.onResize.apply(this,arguments);if(this.el&&this.wrap&&this.textarea){if(typeof b=="number"&&typeof a=="number"){this.textarea.dom.style.height=b+"px";this.textarea.dom.style.width=a+"px";var d=document.getElementById("frame_"+this.textarea.id);if(d!=null){d.style.height=b+"px";d.style.width=a+"px";var c=window.frames["frame_"+this.textarea.id].editArea;if(c){c.execCommand("update_size")}}}}},onDestroy:function(){if(this.rendered){this.wrap.dom.innerHTML="";this.wrap.remove()}},onRender:function(b,a){SqlEditor.superclass.onRender.call(this,b,a);this.el.dom.style.border="0 none";this.el.dom.setAttribute("tabIndex",-1);this.el.addClass("x-hidden");if(Ext.isIE){this.el.applyStyles("margin-top:-1px;margin-bottom:-1px;")}this.wrap=this.el.wrap({height:"100%"});this.textarea=Ext.get(document.createElement("textarea"));this.textarea.dom.disabled=false;this.textarea.dom.style.overflow="auto";this.textarea.dom.style.height="350px";this.textarea.dom.style.width="100%";this.options=this.textarea.dom.className;this.wrap.dom.appendChild(this.textarea.dom);this.id=this.textarea.id;editAreaLoader.init({allow_toggle:false,id:this.textarea.id,syntax:"sql",start_highlight:true,show_line_colors:true,allow_resize:"no",toolbar:"",autocompletion_start:false});editAreaLoader.setValue(this.id,this.initialText)},initialize:function(){this.initialized=true;this.fireEvent("initialize",this)}});function newEditor(c){var b=new EditorPage(c);var a=Ext.getCmp("tabpanelpages");a.add(b);a.doLayout(false);a.activate(b);return b}function createTree(){synchro=new Ext.Toolbar.Button({tooltip:"<b>Link</b><br/>Link Tree with Database Details",icon:"icons/lock.png",enableToggle:true,pressed:true,cls:"x-btn-icon"});treecombo=new Ext.form.ComboBox({store:databasesDataStore,displayField:"name",valueField:"id",typeAhead:false,editable:false,mode:"local",triggerAction:"all",selectOnFocus:true,width:135,forceSelection:true,emptyText:"No connections"});treecombo.on("select",function(l,k,j){if(a&&a.root){a.root.reload()}});treecombo.store.on("load",function(){selectTreeFirst()});var d=new Ext.data.Store({proxy:httpTreeProxy,reader:treeReader});d.on("loadexception",function(){});var h={id:"root",text:"blabla"};var c=new Ext.tree.AsyncTreeNode(h);var g=new TreeStoreLoader({store:d,nodeParamName:"node"});h=Ext.applyIf(h||{},{loader:g});var b=new Ext.Toolbar.Button({tooltip:"<b>New Editor</b><br/>Open a new SQL Editor",icon:"icons/page_edit.png",cls:"x-btn-icon",handler:function(){newEditor("")}});var e=new Ext.Toolbar.Button({tooltip:"<b>New Tables Viewer</b><br/>Open a new Tables Viewer",icon:"icons/table_relationship.png",cls:"x-btn-icon",handler:function(){new RelViewer()}});var c=new Ext.tree.AsyncTreeNode(h);var a=new Ext.tree.TreePanel({border:false,tbar:[synchro,{xtype:"tbseparator"},treecombo,{xtype:"tbseparator"},b,e],title:"",animate:true,enableDD:false,lines:true,rootVisible:false,selModel:new Ext.tree.DefaultSelectionModel(),containerScroll:false,autoScroll:true,enableDrag:true,ddGroup:"testDD",hideMode:"offsets"});a.setRootNode(c);myTreeLoader=g;myTreeLoader.on("beforeload",function(k,j){myTreeLoader.baseParams.dbid=treecombo.getValue()},this);var f=new Ext.menu.Menu();a.on("contextmenu",function(j,k){f.removeAll();var l=j.attributes.type+"-"+treecombo.getValue();dynMenuArray;if(dynMenuArray[l]!=null){buildDynamicMenu(dynMenuArray[l],f);f.nodeid=j;f.showAt(k.getXY())}else{new Ext.data.Connection().request({url:"do?action=getMenu&nodeType="+j.attributes.type+"&sessionid="+treecombo.getValue(),method:"post",scope:this,params:this.baseParams,success:menuSuccess,menuTreeC:f,event:k,node:j,tabKey:l})}});treeselectionModel=a.getSelectionModel();treeselectionModel.on("beforeselect",nodeSelection);return a}function refreshNode(a){a.collapse(false,false);while(a.firstChild){a.removeChild(a.firstChild)}a.childrenRendered=false;a.loaded=false;myTreeLoader.baseParams.refresh=true;a.expand(false,false);myTreeLoader.baseParams.refresh=false}function buildDynamicMenu(arr,menuTreeC){for(var i=0;i<arr.length;i++){if(arr[i][0]=="-"){menuTreeC.add(new Ext.menu.Separator({}))}else{var newitem=new Ext.menu.Item({text:arr[i][0],icon:arr[i][1]});newitem.iindex=i;newitem.on("click",function(){var script=arr[this.iindex][2];eval(script)},this.scope,true);menuTreeC.add(newitem)}}}function menuSuccess(b,d){var c=Ext.decode(b.responseText);var h=d.menuTreeC;var g=d.event;if(c.success){var f=c.result.menu;var a=c.result.menu;dynMenuArray[d.tabKey]=f;buildDynamicMenu(a,h);h.nodeid=d.node;h.showAt(g.getXY())}}function createScheduledPage(){createTabPage("do?action=scheduled","icons/date.png","Scheduled Jobs")}function createReportsPage(){createTabPage("do?action=reports","icons/report.png","Reports")}function createConfigurationPage(){createTabPage("do?action=config","icons/cog.png","Configuration")}function createAboutPage(){createTabPage("do?action=about","icons/information.png","About")}function createDataSourcesPage(){createTabPage("do?action=sourcesPage","icons/transmit.png","Sources")}function createCustomizeExport(){var d=Ext.getCmp("tabpanelpages");var c="";var h="";var e="";var m=new Ext.Panel({autoScroll:true,closable:true,title:"<img src='cd_edit.png' style='vertical-align:bottom;height:16px;width:16px' />&nbsp;Export"});var b=new Ext.form.ComboBox({store:databasesDataStore,fieldLabel:"Connection",displayField:"name",valueField:"id",mode:"local",triggerAction:"all",selectOnFocus:true,width:200,forceSelection:true});b.on("select",function(){var p=databasesDataStore.getById(b.getValue());var q=p.get("catalogs");var t=[];for(i=0;i<q.length;i++){var s=[];s.push(q[i]);t.push(s)}j.loadData(t,false)});var j=new Ext.data.ArrayStore({data:[[]],fields:["databasename"]});var o=new Ext.form.ComboBox({store:j,fieldLabel:"Database",displayField:"databasename",valueField:"databasename",mode:"local",triggerAction:"all",selectOnFocus:true,width:200,forceSelection:true});o.on("select",function(){var p=new Ext.data.JsonReader({root:"result.tables"},["tablename"]);var q=new Ext.data.HttpProxy({url:"request?class=DatabaseInfo&method=getTables&id="+b.getValue()+"&catalogName="+o.getValue(),method:"POST"});var s=new Ext.data.Store({proxy:q,reader:p});s.on("load",t);function t(){var v=[];for(i=0;i<s.getCount();i++){var u=[];u.push(s.getAt(i).get("tablename"));v.push(u)}f.loadData(v,false)}s.load()});var f=new Ext.data.ArrayStore({data:[[]],fields:["tablename"]});var l=new Ext.form.ComboBox({store:f,fieldLabel:"Table",displayField:"tablename",valueField:"tablename",mode:"local",triggerAction:"all",selectOnFocus:true,width:200,forceSelection:true});l.on("select",function(){var t=new Ext.data.JsonReader({root:"result.columns"},["cname"]);var p=new Ext.data.HttpProxy({url:"request?class=DatabaseInfo&method=getColumns&id="+b.getValue()+"&catalogName="+o.getValue()+"&tableName="+l.getValue(),method:"POST"});var s=new Ext.data.Store({proxy:p,reader:t});s.on("load",q);function q(){var v=[];for(i=0;i<s.getCount();i++){var u=[];u.push(s.getAt(i).get("cname"));v.push(u)}Ext.getCmp("columnSelector").fromStore.loadData(v,false);Ext.getCmp("columnSelector").toStore.removeAll()}s.load()});var g=Ext.data.Record.create([{name:"cname",type:"string"}]);var n=new Ext.data.ArrayStore({data:[[]],fields:g,sortInfo:{field:"cname",direction:"ASC"}});var a=new Ext.ux.ItemSelector({name:"columnSelector",id:"columnSelector",fieldLabel:"Columns",dataFields:["cname"],toData:[[]],msWidth:150,msHeight:350,valueField:"cname",displayField:"cname",imagePath:"icons/images/",toLegend:"Selected",fromLegend:"Available",fromStore:n});var k=new Ext.FormPanel({fileUpload:true,width:500,title:"Export Tables",bodyStyle:"padding: 10px 10px 0 10px;",labelWidth:150,items:[{xtype:"combo",name:"separator",id:"separator",fieldLabel:"Column Separator",value:"comma",typeAhead:true,triggerAction:"all",mode:"local",forceSelection:true,displayField:"name",valueField:"value",store:new Ext.data.ArrayStore({fields:["value","name"],data:[["comma","Comma"],["tab","Tab"],["verticalbar","Vertical Bar"]]})},{xtype:"combo",name:"fileencoding",id:"fileencoding",fieldLabel:"File Encoding",value:"ascii",triggerAction:"all",mode:"local",forceSelection:true,displayField:"name",valueField:"value",store:new Ext.data.ArrayStore({fields:["value","name"],data:[["ascii","ASCII"],["utf8","UTF-8"],["unicode","Unicode"]]})},b,o,l,a],buttons:[{text:"Export",handler:function(){if(k.getForm().isValid()){k.getForm().submit({url:"do?action=export",waitMsg:"Exporting...",success:function(p,q){alert("Success"+h+e)}})}}},{text:"Reset",handler:function(){k.getForm().reset()}}]});m.add(k);d.add(m);d.setActiveTab(m)}function createCustomizeImport(){var e=Ext.getCmp("tabpanelpages");var c="";var j="";var f="";var n=new Ext.Panel({autoScroll:true,closable:true,title:"<img src='cd_edit.png' style='vertical-align:bottom;height:16px;width:16px' />&nbsp;Import"});var d=new Ext.ux.form.FileUploadField({allowBlank:false,id:"uploadstep1",emptyText:"Select a CSV File",width:300,fieldLabel:"CSV File",name:"csvfile",buttonText:"",buttonCfg:{iconCls:"upload-icon"}});var p=new Ext.FormPanel({fileUpload:true,width:500,title:"Import Step 1",bodyStyle:"padding: 10px 10px 0 10px;",labelWidth:150,items:[{xtype:"combo",name:"separator",id:"separator",fieldLabel:"Column Separator",value:"comma",typeAhead:true,triggerAction:"all",mode:"local",forceSelection:true,displayField:"name",valueField:"value",store:new Ext.data.ArrayStore({fields:["value","name"],data:[["comma","Comma"],["tab","Tab"],["verticalbar","Vertical Bar"]]})},{xtype:"combo",name:"fileencoding",id:"fileencoding",fieldLabel:"File Encoding",value:"ascii",triggerAction:"all",mode:"local",forceSelection:true,displayField:"name",valueField:"value",store:new Ext.data.ArrayStore({fields:["value","name"],data:[["ascii","ASCII"],["utf8","UTF-8"],["unicode","Unicode"]]})},d],buttons:[{text:"Next...",handler:function(){if(p.getForm().isValid()){p.getForm().submit({url:"do?action=import",waitMsg:"Uploading your file...",success:function(s,u){var t=Ext.util.JSON.decode(u.response.responseText);c=t.result.filename;j=Ext.getCmp("separator").getValue();f=Ext.getCmp("fileencoding").getValue();p.hide();m.show()},failure:function(s,u){var t=Ext.util.JSON.decode(u.response.responseText);alert("upload failed:"+t.error)}})}}},{text:"Reset",handler:function(){p.getForm().reset()}}]});var b=new Ext.form.ComboBox({store:databasesDataStore,fieldLabel:"Connection",displayField:"name",valueField:"id",mode:"local",triggerAction:"all",selectOnFocus:true,width:200,forceSelection:true});b.on("select",function(){var s=databasesDataStore.getById(b.getValue());var t=s.get("catalogs");var v=[];for(i=0;i<t.length;i++){var u=[];u.push(t[i]);v.push(u)}k.loadData(v,false)});var k=new Ext.data.ArrayStore({data:[[]],fields:["databasename"]});var q=new Ext.form.ComboBox({store:k,fieldLabel:"Database",displayField:"databasename",valueField:"databasename",mode:"local",triggerAction:"all",selectOnFocus:true,width:200,forceSelection:true});q.on("select",function(){var s=new Ext.data.JsonReader({root:"result.tables"},["tablename"]);var t=new Ext.data.HttpProxy({url:"request?class=DatabaseInfo&method=getTables&id="+b.getValue()+"&catalogName="+q.getValue(),method:"POST"});var u=new Ext.data.Store({proxy:t,reader:s});u.on("load",v);function v(){var x=[];for(i=0;i<u.getCount();i++){var w=[];w.push(u.getAt(i).get("tablename"));x.push(w)}g.loadData(x,false)}u.load()});var g=new Ext.data.ArrayStore({data:[[]],fields:["tablename"]});var l=new Ext.form.ComboBox({store:g,fieldLabel:"Table",displayField:"tablename",valueField:"tablename",mode:"local",triggerAction:"all",selectOnFocus:true,width:200,forceSelection:true});l.on("select",function(){var v=new Ext.data.JsonReader({root:"result.columns"},["cname"]);var s=new Ext.data.HttpProxy({url:"request?class=DatabaseInfo&method=getColumns&id="+b.getValue()+"&catalogName="+q.getValue()+"&tableName="+l.getValue(),method:"POST"});var u=new Ext.data.Store({proxy:s,reader:v});u.on("load",t);function t(){var x=[];for(i=0;i<u.getCount();i++){var w=[];w.push(u.getAt(i).get("cname"));x.push(w)}Ext.getCmp("columnSelector").fromStore.loadData(x,false);Ext.getCmp("columnSelector").toStore.removeAll()}u.load()});var h=Ext.data.Record.create([{name:"cname",type:"string"}]);var o=new Ext.data.ArrayStore({data:[[]],fields:h,sortInfo:{field:"cname",direction:"ASC"}});var a=new Ext.ux.ItemSelector({name:"columnSelector",id:"columnSelector",fieldLabel:"Columns",dataFields:["cname"],toData:[[]],msWidth:150,msHeight:350,valueField:"cname",displayField:"cname",imagePath:"icons/images/",toLegend:"Selected",fromLegend:"Available",fromStore:o});var m=new Ext.FormPanel({fileUpload:true,width:500,hidden:true,title:"Import Step 2",bodyStyle:"padding: 10px 10px 0 10px;",labelWidth:150,items:[b,q,l,a],buttons:[{text:"Finish",handler:function(){if(m.getForm().isValid()){m.getForm().submit({url:"do?action=import",waitMsg:"Importing...",success:function(s,t){alert("Success"+j+f)}})}}},{text:"Reset",handler:function(){m.getForm().reset()}}]});n.add(p);n.add(m);e.add(n);e.setActiveTab(n)}function createExportTablePage(a){createTabPage("do?action=exportTablePage&id="+a.id,"icons/cd_edit.png","Export Table "+a.attributes.qname)}function createdriversPage(){createTabPage("do?action=driversPage","icons/application.png","drivers")}function createViewQueriesPage(a,b){createTabPage("do?action=queriesPage&sid="+a,"icons/script.png",b)}function createTabPage(d,b,c){var a=Ext.getCmp("tabpanelpages");var e=new Ext.Panel({autoScroll:true,closable:true,title:"<img src='"+b+"' style='vertical-align:bottom;height:16px;width:16px' />&nbsp;"+c});a.add(e);a.setActiveTab(e);e.load({showLoadIndicator:false,nocache:true,url:d+"&pageid="+e.id,scripts:true})}function createTableGrid(c,d,b){rta=[];rta.push(new Ext.grid.RowNumberer());for(i=0;i<d.length;i++){rta.push({header:defaultRenderer(d[i]["l"]),dataIndex:d[i]["l"],sortable:true,renderer:defaultRenderer,align:d[i]["al"]})}var e=[];for(i=0;i<d.length;i++){e.push({name:d[i]["l"]})}var a=new Ext.data.SimpleStore({fields:e});a.loaded=false;return new Ext.grid.GridPanel({border:false,queryID:c,store:a,myData:b,cm:new Ext.grid.ColumnModel(rta),stripeRows:true,view:new Ext.ux.grid.BufferView({scrollDelay:false}),listeners:{render:function(){this.store.loadData(this.myData);this.store.loaded=true}},additionalData:function(f,g){if(this.store.loaded){this.store.loadData(f,true)}},refreshData:function(f){if(this.store.loaded){this.store.loadData(f,false)}}})}function onLayoutCheck(b,a){if(a){preferredLayout=b.sel;b.clLayout.setActiveItem(b.activePanel);b.activePanel.fireEvent("render",b.activePanel)}}function sqlAdditionalSuccessful(b,d){var c=Ext.util.JSON.decode(b.responseText);if(c.success){d.sqlresultpanel.logPanel.info("Additional Data Retrieved.");var a=c.result.data;if(a.length>0){for(var e=0;e<a.length;e++){d.myData.push(a[e])}d.next.enable();for(var e=0;e<d.resultPanels.length;e++){if(d.resultPanels[e].additionalData){d.resultPanels[e].additionalData(a,d.myData)}}}else{d.next.disable()}}else{d.sqlresultpanel.logPanel.error(c.error);Ext.MessageBox.show({title:"Error",msg:c.error,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}}function sqlAdditionalSuccessfulAll(a,b){sqlAdditionalSuccessful(a,b);b.next.disable();b.nextAll.disable()}function RelViewer(){var p=new Ext.Toolbar({listeners:{render:function(){var s=new Ext.Toolbar.Button({cls:"x-btn-icon",icon:"icons/page_white.png",tooltip:"<b>Clear</b><br/>Clear the Editor",handler:function(){var u=this.relViewer.workflow;u.clear();u.addAddRemoveListener(u.riversqlListener)}});var t=new Ext.Toolbar.Button({tooltip:"Show/Hide Grid",enableToggle:true,pressed:true,icon:"icons/grid.gif",cls:"x-btn-icon",handler:function(){if(this.pressed==false){this.relViewer.workflow.html.style.backgroundImage="";this.relViewer.workflow.html.style.background="white"}else{this.relViewer.workflow.html.style.backgroundImage="url(grid_10.png)"}}});s.relViewer=this.relViewer;t.relViewer=this.relViewer;var q=new Ext.Toolbar.Button({cls:"x-btn-icon",icon:"icons/page_white.png",tooltip:"<b>Save</b><br/>Save the Graph",handler:function(){alert(new draw2d.XMLSerializer().toXML(l.getDocument()))}});this.addButton(s);this.addButton(t);this.addButton(q)}}});var a=Ext.id();var m=document.createElement("div");m.style.overflow="auto";m.id=a;var g=Ext.id();var n=document.createElement("div");n.id=g;n.style.overflow="auto";n.style.position="relative";n.style.left="0px";n.style.top="0px";n.style.width="3000px";n.style.height="3000px";m.appendChild(n);var h=new Ext.Element(m);var j=new Ext.Element(n);var c=new Ext.BoxComponent({el:h,region:"center"});var f=new Ext.Panel({title:"<img src='icons/table_relationship.png' style='vertical-align:bottom;height:16px;width:16px' />&nbsp;Tables Viewer",layout:"border",closable:true,autoScroll:false,tbar:p});var o=new Ext.DataView({emptyText:"No Figures yet",deferEmptyText:false,tpl:outlineTempl,singleSelect:true,store:new Ext.data.Store({proxy:new Ext.data.MemoryProxy([]),reader:new Ext.data.ArrayReader({},[{name:"tablefigure"},{name:"title"}])}),selectedClass:"ydataview-selected",itemSelector:"div.x-combo-list-item"});o.on("selectionchange",function(u,w){var t=u.getSelectedRecords();if(t.length>0){var s=t[0].data.tablefigure;if(s!=null){var q=s.x;if(q>100){q=q-100}var v=s.y;if(v>100){v=v-100}u.workflow.scrollTo(q,v,true);u.workflow.setCurrentSelection(s);u.workflow.showResizeHandles(s)}}});var k=new Ext.Panel({items:[o],deferredRender:false,width:200,split:true,collapsible:true,titleCollapse:true,layout:"fit",title:"Outline",autoScroll:true,border:false,region:"east",outlineDataView:o,onAdded:function(q){if(q instanceof draw2d.Line){}else{var s=[[q,q.title]];this.outlineDataView.store.loadData(s,true)}},onRemoved:function(s){if(s==null){this.outlineDataView.clearSelections(true);return}if(s instanceof draw2d.Line){}else{var q=this.outlineDataView.store.find("title",s.title);if(q>-1){this.outlineDataView.store.remove(this.outlineDataView.store.getAt(q))}}},onSelectionChanged:function(s){if(s==null){this.outlineDataView.clearSelections(true);return}if(s instanceof draw2d.Line){}else{var q=this.outlineDataView.store.find("title",s.title);if(q>-1){var t=this.outlineDataView.store.getAt(q);this.outlineDataView.select(q,false,true)}}}});f.add(c);f.add(k);var b=Ext.getCmp("tabpanelpages");p.relViewer=f;b.add(f);b.doLayout(false);b.activate(f);var l=new TableWorkflow(g);var e=new draw2d.Annotation("");e.setStyledText("&nbsp;Drag and Drop tables from <b>Database View</b>...&nbsp;");e.setBackgroundColor(new draw2d.Color(255,128,64));e.setDimension(250,40);e.setDeleteable(false);e.setCanDrag(false);e.setResizeable(false);e.setSelectable(false);l.addFigure(e,10,10);l.scrollArea=m;o.workflow=l;f.workflow=l;l.riversqlListener=k;l.addAddRemoveListener(l.riversqlListener);l.addSelectionListener(l.riversqlListener);var d=new Ext.dd.DropTarget(f.getEl(),{ddGroup:"testDD",_workflow:l,relViewer:f,notifyDrop:function(B,v,u){var w=this._workflow.getAbsoluteX();var s=this._workflow.getAbsoluteY();var t=this._workflow.getScrollLeft();var q=this._workflow.getScrollTop();var A=v.xy[0]-w+t;var z=v.xy[1]-s+q;if(u.node.attributes.type=="tb"){var C=new TableFigure(u.node.attributes.qname);l.addFigure(C,A,z);new Ext.data.Connection().request({url:"do?action=getColumnsForViewer&id="+u.node.attributes.id,method:"post",scope:this,params:{tableFigure:C},callback:function(F,D,y){var E=Ext.decode(y.responseText);arr=E.result.columns;var x=F.params.tableFigure;x.addColumns(arr)}});return true}return false}});return f}function openConnectionDialog(d){var c={width:500,height:200,shadow:true,minWidth:300,minHeight:150,modal:true,collapsible:false,closable:true,title:"Connect to "+d.get("sourceName")};var f=new Ext.Window(c);f.addButton("Cancel",f.close,f);var b=new Ext.form.FormPanel({labelWidth:95,url:"do?action=connect",onSubmit:Ext.emptyFn,baseCls:"x-plain"});function a(){if(b.form.isValid()){b.form.submit({params:{driverid:d.get("driverid"),sourceid:d.get("id")},waitMsg:"Connecting...",failure:submitFailed,success:e})}else{Ext.MessageBox.show({title:"Error",msg:"Please fix the errors noted.",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}}function e(k,m){var j=m.result.result.pluginScripts;if(j){for(var h=0,g=j.length;h<g;h++){load_plugin_script(j[h][0])}}f.close();databasesDataStore.reload()}f.addButton("Connect",a,f);b.add(new Ext.form.TextField({fieldLabel:"Source",name:"source",width:300,readOnly:true,allowBlank:false,value:d.get("sourceName")}),new Ext.form.TextField({fieldLabel:"JDBC Url",name:"url",width:300,readOnly:true,value:d.get("jdbcUrl")}),new Ext.form.TextField({fieldLabel:"User",name:"user",width:300,value:d.get("userName")}),new Ext.form.TextField({inputType:"password",fieldLabel:"Password",name:"password",width:300}),new Ext.form.Checkbox({fieldLabel:"Auto Commit",name:"autocommit",checked:false,value:"1"}));f.show();b.render(f.body)}function nodeSelection(b,d,f){if(synchro.pressed==false){return}if(d==f){return true}var e=d.attributes.type+"-"+treecombo.getValue();if(dynTabsArray[e]!=null){buildDynamicSouth(d,dynTabsArray[e])}else{new Ext.data.Connection().request({url:"do?action=getDetails&nodeType="+d.attributes.type+"&sessionid="+treecombo.getValue(),method:"post",scope:this,params:this.baseParams,success:detailsSuccessful,tabKey:e,newnode:d})}}function buildDynamicSouth(j,k){southPanel.disable();var c=southPanel.getActiveTab();var e=-1;if(c){e=southPanel.items.indexOf(c)}southPanel.beginUpdate();while(southPanel.items.getCount()>0){var m=southPanel.items.last();if(c!=m){southPanel.remove(m)}else{if(southPanel.items.getCount()==1){southPanel.remove(m)}else{southPanel.remove(southPanel.items.first())}}}southPanel.endUpdate();southPanel.doLayout(false);var b=k.length;var n=[];var f=[];for(var h=0;h<b;h++){var g=k[h][0];n[h]=Ext.id();var d=[];var o=[];d.push({header:"1",dataIndex:"1",sortable:false,width:90});o.push({name:"1"});var a=new Ext.data.SimpleStore({fields:o});a.loadData([["Loading..."]]);var l=new Ext.grid.ColumnModel(d);f[h]=new Ext.grid.GridPanel({id:n[h],closable:false,border:false,layout:"fit",stripeRows:true,store:a,cm:l});f[h].title=g;f[h].url=k[h][1];f[h].nextid=n[h];southPanel.add(f[h]);f[h].alreadyActivated=false;f[h].on("activate",function(){pnActivation(j,this)})}southPanel.enable();if(f!=null&&f.length>0){if(e>-1){if(e<f.length){southPanel.setActiveTab(f[e])}else{southPanel.setActiveTab(f[0])}}else{southPanel.setActiveTab(f[0])}}}function pnActivation(d,a){if(a.alreadyActivated==true){return}a.alreadyActivated=true;var b=a.url;var c=a.nextid;new Ext.data.Connection().request({url:b+"&id="+d.id,method:"post",scope:this,panelav:a,nextid:c,success:buildSouthTabItem})}function buildSouthTabItem(d,f){var b=f.nextid;var a=f.panelav;if(a){var e=Ext.util.JSON.decode(d.responseText);if(e.success){var h=[];var g=[];meta=e.result.meta;myData=e.result.data;h.push(new Ext.grid.RowNumberer());for(i=0;i<meta.length;i++){h.push({header:meta[i],dataIndex:meta[i],sortable:false,width:150});g.push({name:meta[i]})}var c=new Ext.data.SimpleStore({fields:g});a.reconfigure(c,new Ext.grid.ColumnModel(h));a.store.loadData(myData)}}return true}function detailsSuccessful(a,c){var b=Ext.decode(a.responseText);if(b.success){details=b.result.details;dynTabsArray[c.tabKey]=details;buildDynamicSouth(c.newnode,details)}}function alterTable(y){var j=[];var c=[];var A=[];var q=new Ext.data.JsonReader({root:"result.types",id:"tp"},["tp"]);var s=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:"do?action=getTypesAlterTable&id="+y.id,method:"post"}),reader:q});s.load();var u=Ext.data.Record.create([{name:"cname",type:"string"},{name:"cnameold",type:"string"},{name:"ctype",type:"string"},{name:"csize",type:"int"},{name:"cdecdig",type:"int"},{name:"cacceptnull"},{name:"ccom"},{name:"cdefault"},{name:"cnew",type:"boolean"},{name:"cchanged",type:"boolean"},{name:"cacceptnullold",type:"boolean"}]);var v=Ext.data.Record.create([{name:"iname",type:"string"},{name:"unique",type:"boolean"},{name:"cols",type:"string"},{name:"idxnew",type:"boolean"}]);var o=Ext.data.Record.create([{name:"pkname",type:"string"},{name:"cols",type:"string"},{name:"pknew",type:"boolean"}]);var g=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:"do?action=getTableColumnsAlterTable&id="+y.id,method:"post"}),reader:new Ext.data.JsonReader({root:"result.columns",id:"cname"},u)});var p=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:"do?action=getTableIndexesAlterTable&id="+y.id,method:"post"}),reader:new Ext.data.JsonReader({root:"result.indexes",id:"iname"},v)});var f=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:"do?action=getPKAlterTable&id="+y.id,method:"post"}),reader:new Ext.data.JsonReader({root:"result.pk",id:"pkname"},o)});var x=new Ext.data.SimpleStore({fields:["value"],data:[[true],[false]]});var k=new Ext.grid.ColumnModel([{id:"pkname",header:"Primary Key Name",width:160,dataIndex:"pkname"},{header:"Columns",width:120,dataIndex:"cols"}]);k.defaultSortable=false;var E=new Ext.grid.ColumnModel([{id:"iname",header:"Index Name",width:160,dataIndex:"iname"},{header:"Unique",width:120,dataIndex:"unique"},{header:"Columns",width:120,dataIndex:"cols"}]);E.defaultSortable=false;var t=new Ext.grid.ColumnModel([{id:"cname",header:"Column Name",width:160,dataIndex:"cname",editor:new Ext.grid.GridEditor(new Ext.form.TextField({allowBlank:false}))},{header:"Type",width:75,dataIndex:"ctype",editor:new Ext.grid.GridEditor(new Ext.form.ComboBox({typeAhead:true,triggerAction:"all",store:s,lazyRender:true,displayField:"tp",mode:"local",editable:false,resizable:true,listWidth:200}))},{header:"Size",width:75,dataIndex:"csize",align:"right",editor:new Ext.grid.GridEditor(new Ext.form.NumberField({allowDecimals:false,allowNegative:false,allowBlank:true}))},{header:"Decimal Digits",width:75,dataIndex:"cdecdig",align:"right",editor:new Ext.grid.GridEditor(new Ext.form.NumberField({allowDecimals:false,allowNegative:false,allowBlank:true}))},{header:"Accept Null Values",width:100,dataIndex:"cacceptnull",editor:new Ext.grid.GridEditor(new Ext.form.ComboBox({typeAhead:true,triggerAction:"all",store:x,lazyRender:true,displayField:"value",mode:"local",editable:false}))},{header:"Remarks",width:75,dataIndex:"ccom",editor:new Ext.grid.GridEditor(new Ext.form.TextField({}))},{header:"Default",width:75,dataIndex:"cdefault",editor:new Ext.grid.GridEditor(new Ext.form.TextField({}))}]);t.defaultSortable=false;var B=new Ext.Toolbar.Button({text:"Add Column",cls:"x-btn-text-icon",icon:"icons/table_add.png",handler:function(){var F=new u({cname:"Column"+g.getCount(),ctype:"VARCHAR",csize:12,cdecdig:0,cacceptnull:true,ccom:"",cdefault:"",cnew:true});n.stopEditing();g.insert(g.getCount(),F);n.startEditing(g.getCount()-1,0)}});var a=new Ext.Toolbar.Button({text:"Drop Column",cls:"x-btn-text-icon",icon:"icons/table_delete.png",handler:function(){n.stopEditing();if(n.getSelectionModel().hasSelection()){var F=n.getSelectionModel().selection.record;j[j.length]=F.get("cnameold");g.remove(F)}}});var n=new Ext.grid.EditorGridPanel({ds:g,cm:t,trackMouseOver:true,title:"Columns",tbar:[B,new Ext.Toolbar.Separator(),a]});n.getSelectionModel().on("selectionchange",function(){if(n.getSelectionModel().hasSelection()){a.enable()}else{a.disable()}});a.disable();var l=new Ext.Toolbar.Button({cls:"x-btn-text-icon",icon:"icons/key_add.png",text:"Add Index",handler:function(){newIndexForAlterTable(y,v,p,g)}});var h=new Ext.Toolbar.Button({text:"Drop Index",cls:"x-btn-text-icon",icon:"icons/key_delete.png",handler:function(){if(D.getSelectionModel().hasSelection()){var F=D.getSelectionModel().getSelected();if(F.get("idxnew")!=true){c[c.length]=F.get("iname")}p.remove(F)}}});var D=new Ext.grid.EditorGridPanel({ds:p,cm:E,trackMouseOver:true,title:"Indexes",selModel:new Ext.grid.RowSelectionModel({singleSelect:true}),tbar:[l,new Ext.Toolbar.Separator(),h]});D.getSelectionModel().on("selectionchange",function(){if(D.getSelectionModel().hasSelection()){h.enable()}else{h.disable()}});h.disable();var z=new Ext.Toolbar.Button({cls:"x-btn-text-icon",icon:"icons/table_key.png",text:"Add PK",handler:function(){newPKForAlterTable(y,o,f,g)}});var w=new Ext.Toolbar.Button({text:"Drop PK",cls:"x-btn-text-icon",icon:"icons/key_delete.png",handler:function(){var F=f.getAt(0);if(F.get("pknew")!=true){A[0]=F.get("pkname")}f.remove(F)}});var C=new Ext.grid.GridPanel({ds:f,cm:k,border:false,title:"Primary Key",trackMouseOver:true,tbar:[z,new Ext.Toolbar.Separator(),w]});var b=new Ext.TabPanel({autoTabs:true,activeTab:0,deferredRender:false,border:false});b.add(n);b.add(D);b.add(C);dialog=new Ext.Window({layout:"fit",width:650,height:500,modal:true,items:b,title:"Alter Table "+y.text});function e(){n.stopEditing();dialog.close()}dialog.addButton("Close",e,dialog);function m(){var M=g.getCount();var I=[];var O=[];var Q=[];var P=[];var J=p.getCount();for(var L=0;L<J;L++){var H=p.getAt(L);if(H.get("idxnew")==true){var K=new Object();K.iname=H.get("iname");K.cols=H.get("cols");K.unique=H.get("unique");Q[Q.length]=K}}var G=f.getCount();for(var L=0;L<G;L++){var N=f.getAt(L);if(N.get("pknew")==true){var K=new Object();K.pkname=N.get("pkname");K.cols=N.get("cols");P[0]=K}}for(var L=0;L<M;L++){var F=g.getAt(L);if(F.get("cnew")==true){var K=new Object();K.cname=F.get("cname");K.ctype=F.get("ctype");K.csize=F.get("csize");K.cdecdig=F.get("cdecdig");K.cacceptnull=F.get("cacceptnull");K.ccom=F.get("ccom");K.cdefault=F.get("cdefault");I[I.length]=K}else{if(F.get("cchanged")==true){var K=new Object();K.cname=F.get("cname");K.cnameold=F.get("cnameold");K.ctype=F.get("ctype");K.csize=F.get("csize");K.cdecdig=F.get("cdecdig");K.cacceptnull=F.get("cacceptnull");K.ccom=F.get("ccom");K.cdefault=F.get("cdefault");K.cacceptnullold=F.get("cacceptnullold");O[O.length]=K}}}new Ext.data.Connection().request({url:"do?action=generateDDLAlterTable",success:function(S){var R=Ext.decode(S.responseText);dialog.close();newEditor(R.result.ddl)},failure:function(){Ext.MessageBox.alert("Failure","");dialog.close()},method:"POST",params:{tableid:y.id,newCols:Ext.encode(I),changedCols:Ext.encode(O),droppedCols:Ext.encode(j),droppedIdx:Ext.encode(c),newIdxs:Ext.encode(Q),newPKs:Ext.encode(P),droppedPKs:Ext.encode(A)}})}dialog.addButton("Generate DDL to Alter Table",m,dialog);dialog.show();b.on("tabchange",function(){n.stopEditing()});n.on("afteredit",function(F){if(F.value!=F.originalValue){if(F.record.get("cnew")!=true){F.record.set("cchanged",true)}}});g.load();p.load();f.load();function d(){if(f.getCount()==0){w.disable();z.enable()}else{w.enable();z.disable()}}f.on("datachanged",function(){d()});f.on("remove",function(){d()});f.on("add",function(){d()})}function createTable(y){var p=new Ext.data.JsonReader({root:"result.types",id:"tp"},["tp"]);var q=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:"do?action=getTypesAlterTable&id="+y.id,method:"post"}),reader:p});q.load();var u=Ext.data.Record.create([{name:"cname",type:"string"},{name:"cnameold",type:"string"},{name:"ctype",type:"string"},{name:"csize",type:"int"},{name:"cdecdig",type:"int"},{name:"cacceptnull"},{name:"ccom"},{name:"cdefault"},{name:"cnew",type:"boolean"}]);var v=Ext.data.Record.create([{name:"iname",type:"string"},{name:"unique",type:"boolean"},{name:"cols",type:"string"},{name:"idxnew",type:"boolean"}]);var n=Ext.data.Record.create([{name:"pkname",type:"string"},{name:"cols",type:"string"},{name:"pknew",type:"boolean"}]);var f=new Ext.data.ArrayStore(u);var o=new Ext.data.ArrayStore(v);var e=new Ext.data.ArrayStore(n);var x=new Ext.data.SimpleStore({fields:["value"],data:[[true],[false]]});var h=new Ext.grid.ColumnModel([{id:"pkname",header:"Primary Key Name",width:160,dataIndex:"pkname"},{header:"Columns",width:120,dataIndex:"cols"}]);h.defaultSortable=false;var D=new Ext.grid.ColumnModel([{id:"iname",header:"Index Name",width:160,dataIndex:"iname"},{header:"Unique",width:120,dataIndex:"unique"},{header:"Columns",width:120,dataIndex:"cols"}]);D.defaultSortable=false;var s=new Ext.grid.ColumnModel([{id:"cname",header:"Column Name",width:160,dataIndex:"cname",editor:new Ext.grid.GridEditor(new Ext.form.TextField({allowBlank:false}))},{header:"Type",width:75,dataIndex:"ctype",editor:new Ext.grid.GridEditor(new Ext.form.ComboBox({typeAhead:true,triggerAction:"all",store:q,lazyRender:true,displayField:"tp",mode:"local",editable:false,resizable:true,listWidth:200}))},{header:"Size",width:75,dataIndex:"csize",align:"right",editor:new Ext.grid.GridEditor(new Ext.form.NumberField({allowDecimals:false,allowNegative:false,allowBlank:true}))},{header:"Decimal Digits",width:75,dataIndex:"cdecdig",align:"right",editor:new Ext.grid.GridEditor(new Ext.form.NumberField({allowDecimals:false,allowNegative:false,allowBlank:true}))},{header:"Accept Null Values",width:100,dataIndex:"cacceptnull",editor:new Ext.grid.GridEditor(new Ext.form.ComboBox({typeAhead:true,triggerAction:"all",store:x,lazyRender:true,displayField:"value",mode:"local",editable:false}))},{header:"Remarks",width:75,dataIndex:"ccom",editor:new Ext.grid.GridEditor(new Ext.form.TextField({}))},{header:"Default",width:75,dataIndex:"cdefault",editor:new Ext.grid.GridEditor(new Ext.form.TextField({}))}]);s.defaultSortable=false;var A=new Ext.Toolbar.Button({text:"Add Column",cls:"x-btn-text-icon",icon:"icons/table_add.png",handler:function(){var E=new u({cname:"Column"+f.getCount(),ctype:"VARCHAR",csize:12,cdecdig:0,cacceptnull:true,ccom:"",cdefault:"",cnew:true});l.stopEditing();f.insert(f.getCount(),E);l.startEditing(f.getCount()-1,0)}});var a=new Ext.Toolbar.Button({text:"Drop Column",cls:"x-btn-text-icon",icon:"icons/table_delete.png",handler:function(){l.stopEditing();if(l.getSelectionModel().hasSelection()){var E=l.getSelectionModel().selection.record;f.remove(E)}}});var l=new Ext.grid.EditorGridPanel({ds:f,cm:s,trackMouseOver:true,title:"Columns",tbar:[A,new Ext.Toolbar.Separator(),a]});l.getSelectionModel().on("selectionchange",function(){if(l.getSelectionModel().hasSelection()){a.enable()}else{a.disable()}});a.disable();var k=new Ext.Toolbar.Button({cls:"x-btn-text-icon",icon:"icons/key_add.png",text:"Add Index",handler:function(){newIndexForAlterTable(y,v,o,f)}});var g=new Ext.Toolbar.Button({text:"Drop Index",cls:"x-btn-text-icon",icon:"icons/key_delete.png",handler:function(){if(C.getSelectionModel().hasSelection()){var E=C.getSelectionModel().getSelected();o.remove(E)}}});var C=new Ext.grid.EditorGridPanel({ds:o,cm:D,trackMouseOver:true,title:"Indexes",selModel:new Ext.grid.RowSelectionModel({singleSelect:true}),tbar:[k,new Ext.Toolbar.Separator(),g]});C.getSelectionModel().on("selectionchange",function(){if(C.getSelectionModel().hasSelection()){g.enable()}else{g.disable()}});g.disable();var z=new Ext.Toolbar.Button({cls:"x-btn-text-icon",icon:"icons/table_key.png",text:"Add PK",handler:function(){newPKForAlterTable(y,n,e,f)}});var w=new Ext.Toolbar.Button({text:"Drop PK",cls:"x-btn-text-icon",icon:"icons/key_delete.png",handler:function(){var E=e.getAt(0);e.remove(E)}});var B=new Ext.grid.GridPanel({ds:e,cm:h,border:false,title:"Primary Key",trackMouseOver:true,tbar:[z,new Ext.Toolbar.Separator(),w]});var b=new Ext.TabPanel({height:400,autoTabs:true,activeTab:0,deferredRender:false,border:false});b.add(l);b.add(C);b.add(B);var m=new Ext.form.FormPanel({labelWidth:95,onSubmit:Ext.emptyFn,baseCls:"x-plain"});var j=new Ext.form.TextField({fieldLabel:"Table Name",name:"dbname",width:180,readOnly:false,allowBlank:false});m.add(j);m.add(b);dialog=new Ext.Window({layout:"fit",width:650,height:500,modal:true,items:[m],title:"Create Table at Schema: "+y.text});function d(){l.stopEditing();dialog.close()}dialog.addButton("Close",d,dialog);function t(){var H=[];var O=[];var N=[];var I=o.getCount();for(var K=0;K<I;K++){var G=o.getAt(K);if(G.get("idxnew")==true){var J=new Object();J.iname=G.get("iname");J.cols=G.get("cols");J.unique=G.get("unique");O[O.length]=J}}var F=e.getCount();for(var K=0;K<F;K++){var M=e.getAt(K);if(M.get("pknew")==true){var J=new Object();J.pkname=M.get("pkname");J.cols=M.get("cols");N[N.length]=J}}var L=f.getCount();for(var K=0;K<L;K++){var E=f.getAt(K);if(E.get("cnew")==true){var J=new Object();J.cname=E.get("cname");J.ctype=E.get("ctype");J.csize=E.get("csize");J.cdecdig=E.get("cdecdig");J.cacceptnull=E.get("cacceptnull");J.ccom=E.get("ccom");J.cdefault=E.get("cdefault");H[H.length]=J}}new Ext.data.Connection().request({url:"do?action=generateDDLCreateTable",success:function(Q){var P=Ext.decode(Q.responseText);dialog.close();newEditor(P.result.ddl)},failure:function(){Ext.MessageBox.alert("Failure","");dialog.close()},method:"POST",params:{tableid:y.id,schemaname:y.text,tablename:j.getValue(),newCols:Ext.encode(H),newIdxs:Ext.encode(O),newPKs:Ext.encode(N)}})}dialog.addButton("Generate DDL to Create Table",t,dialog);dialog.show();b.on("tabchange",function(){l.stopEditing()});function c(){if(e.getCount()==0){w.disable();z.enable()}else{w.enable();z.disable()}}e.on("datachanged",function(){c()});e.on("remove",function(){c()});e.on("add",function(){c()})}function newIndexForAlterTable(b,d,h,e){var a={width:700,height:350,shadow:true,minWidth:300,minHeight:250,modal:true,collapsible:false,closable:true,title:"Create Index for Table "+b.text+"...",labelWidth:100};var g=new Ext.Window(a);g.addButton("Close",g.close,g);var f=new Ext.form.Checkbox({boxLabel:"",name:"unique",fieldLabel:"Unique",labelAlign:"left",value:"1"});var k=new Ext.form.TextField({fieldLabel:"Index Name",name:"name",width:200,readOnly:false,allowBlank:false});columnSelector=new Ext.ux.ItemSelector({name:"itemselector",fieldLabel:"Column",dataFields:["cname"],toData:[[]],msWidth:250,msHeight:200,valueField:"cname",displayField:"cname",imagePath:"icons/images/",toLegend:"Selected",fromLegend:"Available",fromStore:e});var j=new Ext.form.FormPanel({labelAlign:"left",frame:true,url:"do?action=generateDDLCreateIndex",bodyStyle:"padding:5px 5px 0",items:[k,f,columnSelector]});function c(){var l=[];for(var m=0;m<columnSelector.toStore.getCount();m++){record=columnSelector.toStore.getAt(m);var o=record.get(columnSelector.valueField);if(o!=""){l.push(o)}}var n=new d({iname:k.getValue(),cols:l,unique:f.getValue(),idxnew:true});h.insert(h.getCount(),n);g.close()}g.addButton("Ok",c,g);g.show();j.render(g.body)}function newPKForAlterTable(c,h,j,f){var b={width:700,height:350,shadow:true,minWidth:300,minHeight:250,modal:true,collapsible:false,closable:true,title:"Create Primary Key for Table "+c.text+"...",labelWidth:100};var e=new Ext.form.TextField({fieldLabel:"Primay Key Name",name:"name",width:200,readOnly:false,allowBlank:false});var g=new Ext.Window(b);g.addButton("Close",g.close,g);columnSelector=new Ext.ux.ItemSelector({name:"itemselector",fieldLabel:"Column",dataFields:["cname"],toData:[[]],msWidth:250,msHeight:200,valueField:"cname",displayField:"cname",imagePath:"icons/images/",toLegend:"Selected",fromLegend:"Available",fromStore:f});var d=new Ext.form.FormPanel({labelAlign:"left",frame:true,bodyStyle:"padding:5px 5px 0",items:[e,columnSelector]});function a(){var k=[];for(var l=0;l<columnSelector.toStore.getCount();l++){record=columnSelector.toStore.getAt(l);var n=record.get(columnSelector.valueField);if(n!=""){k.push(n)}}var m=new h({cols:k,pkname:e.getValue(),pknew:true});j.insert(j.getCount(),m);g.close()}g.addButton("Ok",a,g);g.show();d.render(g.body)}function load_plugin_script(c){if(loaded_plugin_scripts[c]){return}try{var a=document.createElement("script");a.type="text/javascript";a.src=c;a.charset="UTF-8";var b=document.getElementsByTagName("head");b[0].appendChild(a)}catch(d){document.write('<script language="javascript" type="text/javascript" src="'+c+'" charset="UTF-8"><\/script>')}}function exportTable(a){createExportTablePage(a)};